<UserControl x:Class="AssetProcessor.Controls.ORMPackingPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:core="clr-namespace:AssetProcessor.TextureConversion.Core"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="350">

    <UserControl.Resources>
        <ObjectDataProvider x:Key="CompressionFormatValues" MethodName="GetValues" ObjectType="{x:Type core:CompressionFormat}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="core:CompressionFormat"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>

        <ObjectDataProvider x:Key="FilterTypeValues" MethodName="GetValues" ObjectType="{x:Type core:FilterType}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="core:FilterType"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>

        <ObjectDataProvider x:Key="ToksvigCalculationModeValues" MethodName="GetValues" ObjectType="{x:Type core:ToksvigCalculationMode}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="core:ToksvigCalculationMode"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>

        <Style x:Key="ReadableComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Background" Value="#F5F5F5"/>
            <Setter Property="Foreground" Value="#2C3E50"/>
            <Setter Property="BorderBrush" Value="#BDC3C7"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="3,1"/>
            <Setter Property="FontSize" Value="10"/>
        </Style>

        <Style TargetType="ComboBoxItem">
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="#2C3E50"/>
            <Setter Property="Padding" Value="3,1"/>
            <Setter Property="FontSize" Value="10"/>
        </Style>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="10">
            <TextBlock Text="ORM Channel Packing" FontSize="16" FontWeight="Bold" Margin="0,0,0,5"/>

            <!-- Packing Mode -->
            <GroupBox Header="Packing Mode" Margin="0,0,0,5">
                <StackPanel>
                    <ComboBox x:Name="PackingModeComboBox" Style="{StaticResource ReadableComboBoxStyle}"
                              SelectionChanged="PackingModeComboBox_SelectionChanged">
                        <ComboBoxItem Content="OG (RGB=AO, A=Gloss)" Tag="OG"/>
                        <ComboBoxItem Content="OGM (R=AO, G=Gloss, B=Metallic)" Tag="OGM" IsSelected="True"/>
                        <ComboBoxItem Content="OGMH (R=AO, G=Gloss, B=Metallic, A=Height)" Tag="OGMH"/>
                    </ComboBox>
                </StackPanel>
            </GroupBox>

            <!-- Sources -->
            <GroupBox Header="Channel Sources" Margin="0,0,0,5">
                <StackPanel>
                    <TextBlock Text="AO:" FontSize="10" FontWeight="Bold"/>
                    <ComboBox x:Name="AOSourceComboBox" Style="{StaticResource ReadableComboBoxStyle}"
                              DisplayMemberPath="Name" Margin="0,0,0,3"
                              SelectionChanged="SourceComboBox_SelectionChanged"/>

                    <TextBlock Text="Gloss:" FontSize="10" FontWeight="Bold"/>
                    <ComboBox x:Name="GlossSourceComboBox" Style="{StaticResource ReadableComboBoxStyle}"
                              DisplayMemberPath="Name" Margin="0,0,0,3"
                              SelectionChanged="SourceComboBox_SelectionChanged"/>

                    <StackPanel x:Name="MetallicPanel">
                        <TextBlock Text="Metallic:" FontSize="10" FontWeight="Bold"/>
                        <ComboBox x:Name="MetallicSourceComboBox" Style="{StaticResource ReadableComboBoxStyle}"
                                  DisplayMemberPath="Name" Margin="0,0,0,3"
                                  SelectionChanged="SourceComboBox_SelectionChanged"/>
                    </StackPanel>

                    <StackPanel x:Name="HeightPanel" Visibility="Collapsed">
                        <TextBlock Text="Height:" FontSize="10" FontWeight="Bold"/>
                        <ComboBox x:Name="HeightSourceComboBox" Style="{StaticResource ReadableComboBoxStyle}"
                                  DisplayMemberPath="Name" Margin="0,0,0,3"
                                  SelectionChanged="SourceComboBox_SelectionChanged"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <!-- Compression Settings -->
            <GroupBox Header="Compression Settings" Margin="0,0,0,5">
                <StackPanel>
                    <TextBlock Text="Format:" FontSize="10" FontWeight="Bold"/>
                    <ComboBox x:Name="CompressionFormatComboBox" Style="{StaticResource ReadableComboBoxStyle}"
                              ItemsSource="{Binding Source={StaticResource CompressionFormatValues}}"
                              SelectionChanged="CompressionFormat_Changed" Margin="0,0,0,3"/>

                    <StackPanel x:Name="ETC1SPanel">
                        <TextBlock Text="Quality Level (1-255):" FontSize="10"/>
                        <Slider x:Name="QualityLevelSlider" Minimum="1" Maximum="255" Value="128"
                                TickFrequency="1" IsSnapToTickEnabled="True"/>
                        <TextBlock Text="{Binding ElementName=QualityLevelSlider, Path=Value, StringFormat='{}{0:F0}'}"
                                   HorizontalAlignment="Center" FontSize="10"/>
                    </StackPanel>

                    <StackPanel x:Name="UASTCPanel" Visibility="Collapsed">
                        <TextBlock Text="UASTC Quality (0-4):" FontSize="10"/>
                        <Slider x:Name="UASTCQualitySlider" Minimum="0" Maximum="4" Value="2"
                                TickFrequency="1" IsSnapToTickEnabled="True"/>
                        <TextBlock Text="{Binding ElementName=UASTCQualitySlider, Path=Value, StringFormat='{}{0:F0}'}"
                                   HorizontalAlignment="Center" FontSize="10"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <!-- Mipmap Settings -->
            <GroupBox Header="Mipmap Settings" Margin="0,0,0,5">
                <StackPanel>
                    <TextBlock Text="Mipmap Count:" FontSize="10"/>
                    <Slider x:Name="MipmapCountSlider" Minimum="1" Maximum="12" Value="0"
                            TickFrequency="1" IsSnapToTickEnabled="True"/>
                    <TextBlock Text="{Binding ElementName=MipmapCountSlider, Path=Value, StringFormat='{}Auto ({0} max)'}"
                               HorizontalAlignment="Center" FontSize="10"/>

                    <TextBlock Text="Filter:" FontSize="10" FontWeight="Bold" Margin="0,5,0,0"/>
                    <ComboBox x:Name="FilterTypeComboBox" Style="{StaticResource ReadableComboBoxStyle}"
                              ItemsSource="{Binding Source={StaticResource FilterTypeValues}}"/>
                </StackPanel>
            </GroupBox>

            <!-- AO Processing -->
            <GroupBox Header="AO Processing" Margin="0,0,0,5">
                <StackPanel>
                    <ComboBox x:Name="AOProcessingComboBox" Style="{StaticResource ReadableComboBoxStyle}"
                              SelectionChanged="AOProcessing_Changed">
                        <ComboBoxItem Content="Biased Darkening" Tag="BiasedDarkening" IsSelected="True"/>
                        <ComboBoxItem Content="Percentile" Tag="Percentile"/>
                        <ComboBoxItem Content="None" Tag="None"/>
                    </ComboBox>

                    <StackPanel x:Name="AOBiasPanel" Margin="0,3,0,0">
                        <TextBlock Text="Bias:" FontSize="10"/>
                        <Slider x:Name="AOBiasSlider" Minimum="0.1" Maximum="1.0" Value="0.5"
                                TickFrequency="0.1" IsSnapToTickEnabled="True"
                                ValueChanged="AOBias_ValueChanged"/>
                        <TextBlock Text="{Binding ElementName=AOBiasSlider, Path=Value, StringFormat='{}{0:F1}'}"
                                   HorizontalAlignment="Center" FontSize="10"/>
                    </StackPanel>

                    <StackPanel x:Name="AOPercentilePanel" Visibility="Collapsed" Margin="0,3,0,0">
                        <TextBlock Text="Percentile (%):" FontSize="10"/>
                        <Slider x:Name="AOPercentileSlider" Minimum="1" Maximum="50" Value="10"
                                TickFrequency="1" IsSnapToTickEnabled="True"/>
                        <TextBlock Text="{Binding ElementName=AOPercentileSlider, Path=Value, StringFormat='{}{0:F0}%'}"
                                   HorizontalAlignment="Center" FontSize="10"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <!-- Toksvig Settings -->
            <GroupBox Header="Toksvig (Gloss Anti-Aliasing)" Margin="0,0,0,5">
                <StackPanel>
                    <CheckBox x:Name="GlossToksvigCheckBox" Content="Enable Toksvig"
                              IsChecked="True" Margin="0,0,0,3"
                              Checked="GlossToksvig_Changed" Unchecked="GlossToksvig_Changed"/>

                    <StackPanel x:Name="GlossToksvigPanel">
                        <TextBlock Text="Calculation Mode:" FontSize="10"/>
                        <ComboBox x:Name="ToksvigCalculationModeComboBox" Style="{StaticResource ReadableComboBoxStyle}"
                                  ItemsSource="{Binding Source={StaticResource ToksvigCalculationModeValues}}"
                                  Margin="0,0,0,3"/>

                        <TextBlock Text="Composite Power (0.5-8):" FontSize="10"/>
                        <Slider x:Name="GlossToksvigPowerSlider" Minimum="0.5" Maximum="8" Value="1.0"
                                TickFrequency="0.1" IsSnapToTickEnabled="True"/>
                        <TextBlock Text="{Binding ElementName=GlossToksvigPowerSlider, Path=Value, StringFormat='{}{0:F1}'}"
                                   HorizontalAlignment="Center" FontSize="10"/>

                        <TextBlock Text="Min Mip Level:" FontSize="10" Margin="0,3,0,0"/>
                        <Slider x:Name="ToksvigMinMipLevelSlider" Minimum="0" Maximum="5" Value="0"
                                TickFrequency="1" IsSnapToTickEnabled="True"/>
                        <TextBlock Text="{Binding ElementName=ToksvigMinMipLevelSlider, Path=Value, StringFormat='{}{0:F0}'}"
                                   HorizontalAlignment="Center" FontSize="10"/>

                        <CheckBox x:Name="ToksvigEnergyPreservingCheckBox" Content="Energy-Preserving Filtering"
                                  IsChecked="True" Margin="0,3,0,0"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <!-- Status -->
            <GroupBox Header="Status" Margin="0,0,0,5">
                <StackPanel>
                    <TextBlock x:Name="StatusText" Text="Ready" TextWrapping="Wrap" FontSize="11"/>
                    <TextBlock x:Name="MissingChannelsText" Text="" TextWrapping="Wrap" FontSize="10" Foreground="Orange"/>
                </StackPanel>
            </GroupBox>

            <!-- Pack Button -->
            <Button x:Name="PackConvertButton" Content="Pack &amp; Convert to KTX2"
                    Click="PackConvert_Click" Height="35" FontSize="14" FontWeight="Bold"
                    Background="#FF4CAF50" Foreground="White"/>
        </StackPanel>
    </ScrollViewer>
</UserControl>
