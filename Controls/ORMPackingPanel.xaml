<UserControl x:Class="AssetProcessor.Controls.ORMPackingPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="350">
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="10">
            <!-- Header -->
            <TextBlock Text="ORM Channel Packing" FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>
            <TextBlock Text="Configure multi-channel packing for glTF/PlayCanvas"
                       FontSize="11" Foreground="Gray" TextWrapping="Wrap" Margin="0,0,0,15"/>

            <!-- Packing Mode -->
            <GroupBox Header="Packing Mode" Margin="0,0,0,10">
                <StackPanel>
                    <ComboBox x:Name="PackingModeComboBox" SelectionChanged="PackingModeComboBox_SelectionChanged">
                        <ComboBoxItem Content="OG (RGB=AO, A=Gloss)" Tag="OG"/>
                        <ComboBoxItem Content="OGM (R=AO, G=Gloss, B=Metallic)" Tag="OGM" IsSelected="True"/>
                        <ComboBoxItem Content="OGMH (R=AO, G=Gloss, B=Metallic, A=Height)" Tag="OGMH"/>
                    </ComboBox>
                    <TextBlock x:Name="ModeDescription" Text="Standard 3-channel packing"
                               FontSize="10" Foreground="Gray" Margin="0,5,0,0" TextWrapping="Wrap"/>
                </StackPanel>
            </GroupBox>

            <!-- AO Channel (R or RGB) -->
            <GroupBox Header="ðŸ”´ AO Channel" Margin="0,0,0,10">
                <StackPanel>
                    <Label Content="Source Texture:" FontWeight="Bold"/>
                    <ComboBox x:Name="AOSourceComboBox" DisplayMemberPath="Name" SelectionChanged="SourceComboBox_SelectionChanged"/>
                    <Button Content="Auto-Detect" Click="AutoDetectAO_Click" Margin="0,5,0,10" Padding="5,2"/>

                    <Label Content="Mipmap Processing:" FontWeight="Bold" Margin="0,10,0,0"/>
                    <ComboBox x:Name="AOProcessingComboBox" SelectionChanged="AOProcessing_Changed">
                        <ComboBoxItem Content="Biased Darkening (Recommended)" Tag="BiasedDarkening" IsSelected="True"/>
                        <ComboBoxItem Content="Percentile-based" Tag="Percentile"/>
                        <ComboBoxItem Content="None" Tag="None"/>
                    </ComboBox>

                    <StackPanel x:Name="AOBiasPanel" Margin="0,5,0,0">
                        <Label Content="Bias (0.3=darker, 0.7=lighter):" FontSize="10"/>
                        <Slider x:Name="AOBiasSlider" Minimum="0.1" Maximum="1.0" Value="0.5"
                                TickFrequency="0.1" IsSnapToTickEnabled="True"
                                ValueChanged="AOBias_ValueChanged"/>
                        <TextBlock Text="{Binding ElementName=AOBiasSlider, Path=Value, StringFormat='{}{0:F1}'}"
                                   HorizontalAlignment="Center" FontSize="10"/>
                    </StackPanel>

                    <StackPanel x:Name="AOPercentilePanel" Visibility="Collapsed" Margin="0,5,0,0">
                        <Label Content="Percentile (%):" FontSize="10"/>
                        <Slider x:Name="AOPercentileSlider" Minimum="1" Maximum="50" Value="10"
                                TickFrequency="1" IsSnapToTickEnabled="True"/>
                        <TextBlock Text="{Binding ElementName=AOPercentileSlider, Path=Value, StringFormat='{}  {0:F0}%'}"
                                   HorizontalAlignment="Center" FontSize="10"/>
                    </StackPanel>

                    <Label Content="Default Value (if no source):" FontSize="10" Margin="0,5,0,0"/>
                    <Slider x:Name="AODefaultSlider" Minimum="0" Maximum="1" Value="1.0"
                            TickFrequency="0.1" IsSnapToTickEnabled="True"/>
                    <TextBlock Text="{Binding ElementName=AODefaultSlider, Path=Value, StringFormat='{}{0:F1}'}"
                               HorizontalAlignment="Center" FontSize="10"/>
                </StackPanel>
            </GroupBox>

            <!-- Gloss Channel (G or A) -->
            <GroupBox Header="ðŸŸ¢ Gloss Channel" Margin="0,0,0,10">
                <StackPanel>
                    <Label Content="Source Texture:" FontWeight="Bold"/>
                    <ComboBox x:Name="GlossSourceComboBox" DisplayMemberPath="Name" SelectionChanged="SourceComboBox_SelectionChanged"/>
                    <Button Content="Auto-Detect" Click="AutoDetectGloss_Click" Margin="0,5,0,10" Padding="5,2"/>

                    <CheckBox x:Name="GlossToksvigCheckBox" Content="Enable Toksvig Correction"
                              IsChecked="True" Margin="0,5,0,5" Checked="GlossToksvig_Changed" Unchecked="GlossToksvig_Changed"/>

                    <StackPanel x:Name="GlossToksvigPanel" Margin="10,0,0,0">
                        <Label Content="Composite Power (1-8):" FontSize="10"/>
                        <Slider x:Name="GlossToksvigPowerSlider" Minimum="1" Maximum="8" Value="4"
                                TickFrequency="1" IsSnapToTickEnabled="True"/>
                        <TextBlock Text="{Binding ElementName=GlossToksvigPowerSlider, Path=Value, StringFormat='{}{0:F0}'}"
                                   HorizontalAlignment="Center" FontSize="10"/>
                        <TextBlock Text="Normal map will be auto-detected" FontSize="9" Foreground="Gray" Margin="0,2,0,0"/>
                    </StackPanel>

                    <Label Content="Default Value (if no source):" FontSize="10" Margin="0,10,0,0"/>
                    <Slider x:Name="GlossDefaultSlider" Minimum="0" Maximum="1" Value="0.5"
                            TickFrequency="0.1" IsSnapToTickEnabled="True"/>
                    <TextBlock Text="{Binding ElementName=GlossDefaultSlider, Path=Value, StringFormat='{}{0:F1}'}"
                               HorizontalAlignment="Center" FontSize="10"/>
                </StackPanel>
            </GroupBox>

            <!-- Metallic Channel (B) - Only for OGM/OGMH -->
            <GroupBox x:Name="MetallicPanel" Header="ðŸ”µ Metallic Channel" Margin="0,0,0,10">
                <StackPanel>
                    <Label Content="Source Texture:" FontWeight="Bold"/>
                    <ComboBox x:Name="MetallicSourceComboBox" DisplayMemberPath="Name" SelectionChanged="SourceComboBox_SelectionChanged"/>
                    <Button Content="Auto-Detect" Click="AutoDetectMetallic_Click" Margin="0,5,0,10" Padding="5,2"/>

                    <Label Content="Default Value (if no source):" FontSize="10"/>
                    <Slider x:Name="MetallicDefaultSlider" Minimum="0" Maximum="1" Value="0.0"
                            TickFrequency="0.1" IsSnapToTickEnabled="True"/>
                    <TextBlock Text="{Binding ElementName=MetallicDefaultSlider, Path=Value, StringFormat='{}{0:F1}'}"
                               HorizontalAlignment="Center" FontSize="10"/>
                </StackPanel>
            </GroupBox>

            <!-- Height Channel (A) - Only for OGMH -->
            <GroupBox x:Name="HeightPanel" Header="âšª Height Channel" Margin="0,0,0,10" Visibility="Collapsed">
                <StackPanel>
                    <Label Content="Source Texture:" FontWeight="Bold"/>
                    <ComboBox x:Name="HeightSourceComboBox" DisplayMemberPath="Name" SelectionChanged="SourceComboBox_SelectionChanged"/>
                    <Button Content="Auto-Detect" Click="AutoDetectHeight_Click" Margin="0,5,0,10" Padding="5,2"/>

                    <Label Content="Default Value (if no source):" FontSize="10"/>
                    <Slider x:Name="HeightDefaultSlider" Minimum="0" Maximum="1" Value="0.5"
                            TickFrequency="0.1" IsSnapToTickEnabled="True"/>
                    <TextBlock Text="{Binding ElementName=HeightDefaultSlider, Path=Value, StringFormat='{}{0:F1}'}"
                               HorizontalAlignment="Center" FontSize="10"/>
                </StackPanel>
            </GroupBox>

            <!-- Status -->
            <GroupBox Header="Status" Margin="0,0,0,10">
                <StackPanel>
                    <TextBlock x:Name="StatusText" Text="Ready to configure channels"
                               TextWrapping="Wrap" FontSize="11"/>
                    <TextBlock x:Name="MissingChannelsText" Text=""
                               TextWrapping="Wrap" FontSize="10" Foreground="Orange" Margin="0,5,0,0"/>
                </StackPanel>
            </GroupBox>

            <!-- Pack & Convert Button -->
            <Button x:Name="PackConvertButton" Content="Pack &amp; Convert to KTX2"
                    Click="PackConvert_Click" Height="35" FontSize="14" FontWeight="Bold"
                    Background="#FF4CAF50" Foreground="White" Margin="0,10,0,0"/>

            <TextBlock Text="Tip: Use Auto-Detect to find textures by naming patterns (_ao, _gloss, _metallic)"
                       FontSize="9" Foreground="Gray" TextWrapping="Wrap" Margin="0,10,0,0"/>
        </StackPanel>
    </ScrollViewer>
</UserControl>
