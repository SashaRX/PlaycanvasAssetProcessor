# Безопасность Playcanvas Asset Processor

## Хранение Playcanvas API Key

* Ключ сохраняется в пользовательских настройках только в зашифрованном виде. На Windows используется **DPAPI** с областью `CurrentUser`.
* На других платформах ключ шифруется алгоритмом AES-256, ключ шифрования выводится из мастер-пароля.
* Для запуска вне Windows необходимо задать переменную окружения `PLAYCANVAS_MASTER_PASSWORD` перед сохранением API-ключа. При отсутствии переменной запись/чтение ключа завершится ошибкой.
* При первом чтении старого (незашифрованного) значения настройки автоматически перезаписываются в защищённом формате.

## UI

* В окне настроек (`SettingsWindow`) поле API-ключа заменено на `PasswordBox`. Кнопка «Показать» отображает значение только после подтверждения пользователя и автоматически возвращает скрытие при повторном нажатии.
* Служебный текст под полем напоминает о скрытии ключа после просмотра.

## Использование в коде

* Доступ к ключу осуществляется через методы `AppSettings.Default.TryGetDecryptedPlaycanvasApiKey(...)` или `GetDecryptedPlaycanvasApiKey()`.
* В `MainWindow` и `ImageHelper` ключ запрашивается непосредственно перед выполнением запроса к PlayCanvas API и не кэшируется дольше, чем требуется операции.
* `MainViewModel` использует вспомогательный метод `ResolveApiKey()` и формирует сообщения об ошибках при невозможности расшифровки.

## Тестирование

* Добавлен модульный тест `SecureSettingsTests` удостоверяющийся, что значение API-ключа шифруется и корректно расшифровывается.
* Для Linux/macOS тесты автоматически выставляют `PLAYCANVAS_MASTER_PASSWORD=UnitTestSecret!`.
