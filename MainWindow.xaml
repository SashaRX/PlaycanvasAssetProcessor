<Window
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
    xmlns:local="clr-namespace:AssetProcessor"
    xmlns:settings="clr-namespace:AssetProcessor.Settings"
    xmlns:controls="clr-namespace:AssetProcessor.Controls"
    xmlns:help ="clr-namespace:AssetProcessor.Helpers"
    xmlns:viewer="clr-namespace:AssetProcessor.TextureViewer"
    xmlns:av="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:helix="http://helix-toolkit.org/wpf"
    xmlns:oxy="http://oxyplot.org/wpf"
    xmlns:resources="clr-namespace:AssetProcessor.Resources"
    xmlns:viewModels="clr-namespace:AssetProcessor.ViewModels"
    xmlns:infra="clr-namespace:AssetProcessor.Infrastructure"
    av:DataContext="{av:DesignInstance Type=viewModels:MainViewModel}"
    mc:Ignorable="av"
    x:Class="AssetProcessor.MainWindow"
    Title="MainWindow" Height="684" Width="942">

    <Window.Resources>
        <help:SizeConverter x:Key="SizeConverter" />
        <help:ResolutionConverter x:Key="ResolutionConverter" />
        <help:StatusToVisibilityConverter x:Key="StatusToVisibilityConverter" />
        <help:StatusToVisibilityInverseConverter x:Key="StatusToVisibilityInverseConverter" />
        <help:StatusToBackgroundConverter x:Key="StatusToBackgroundConverter" />
        <help:TextureTypeToBackgroundConverter x:Key="TextureTypeToBackgroundConverter" />
        <help:ORMTextureColorConverter x:Key="ORMTextureColorConverter" />


        <Style TargetType="Expander">
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Padding" Value="2"/>
            <Setter Property="Background" Value="#FFB1B1B1"/>
            <Setter Property="BorderBrush" Value="Black"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="FontWeight" Value="Bold"/>
        </Style>

        <!-- Compact style for right panel expanders -->
        <Style x:Key="CompactExpanderStyle" TargetType="Expander">
            <Setter Property="Margin" Value="0,0,0,2"/>
            <Setter Property="Padding" Value="2"/>
            <Setter Property="BorderBrush" Value="#CCCCCC"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Background" Value="Transparent"/>
        </Style>

        <help:ChannelColorConverter x:Key="ChannelColorConverter" />
        <Style TargetType="ComboBoxItem">
            <Setter Property="Background" Value="{Binding ., Converter={StaticResource ChannelColorConverter}, ConverterParameter=Background}" />
            <Setter Property="Foreground" Value="{Binding ., Converter={StaticResource ChannelColorConverter}, ConverterParameter=Foreground}" />
        </Style>

        <!-- Стиль для кликабельных гиперссылок текстур в материалах -->
        <Style x:Key="TextureHyperlinkStyle" TargetType="Hyperlink">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#FF0066CC"/>
            <Setter Property="TextDecorations" Value="Underline"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Foreground" Value="#FF0099FF"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- ContextMenu для заголовков колонок текстур -->
        <ContextMenu x:Key="TextureColumnHeaderContextMenu">
            <MenuItem Header="Columns Visibility">
                <MenuItem Header="ID" IsCheckable="True" IsChecked="True" Click="TextureColumnVisibility_Click" Tag="ID"/>
                <MenuItem Header="Texture Name" IsCheckable="True" IsChecked="True" Click="TextureColumnVisibility_Click" Tag="TextureName"/>
                <MenuItem Header="Extension" IsCheckable="True" IsChecked="True" Click="TextureColumnVisibility_Click" Tag="Extension"/>
                <MenuItem Header="Size" IsCheckable="True" IsChecked="True" Click="TextureColumnVisibility_Click" Tag="Size"/>
                <MenuItem Header="Resolution" IsCheckable="True" IsChecked="True" Click="TextureColumnVisibility_Click" Tag="Resolution"/>
                <MenuItem Header="Resize Resolution" IsCheckable="True" IsChecked="True" Click="TextureColumnVisibility_Click" Tag="ResizeResolution"/>
                <MenuItem Header="Compression" IsCheckable="True" IsChecked="True" Click="TextureColumnVisibility_Click" Tag="Compression"/>
                <MenuItem Header="Mipmaps" IsCheckable="True" IsChecked="True" Click="TextureColumnVisibility_Click" Tag="Mipmaps"/>
                <MenuItem Header="Preset" IsCheckable="True" IsChecked="True" Click="TextureColumnVisibility_Click" Tag="Preset"/>
                <MenuItem Header="Status/Progress" IsCheckable="True" IsChecked="True" Click="TextureColumnVisibility_Click" Tag="Status"/>
            </MenuItem>
        </ContextMenu>

        <!-- ContextMenu для строк текстур -->
        <ContextMenu x:Key="TextureRowContextMenu">
            <MenuItem Header="Process Texture" Click="ProcessSelectedTextures_Click"/>
            <MenuItem Header="Upload to PlayCanvas" Click="UploadTexture_Click"/>
            <Separator/>
            <MenuItem Header="Delete ORM Texture" Click="DeleteORMFromList_Click"/>
            <Separator/>
            <MenuItem Header="Open File Location" Click="OpenFileLocation_Click"/>
            <MenuItem Header="Copy Path" Click="CopyTexturePath_Click"/>
            <Separator/>
            <MenuItem Header="Refresh Preview" Click="RefreshPreview_Click"/>
        </ContextMenu>

        <!-- ContextMenu для строк моделей -->
        <ContextMenu x:Key="ModelRowContextMenu">
            <MenuItem Header="Process Model" Click="ProcessSelectedModel_Click"/>
            <MenuItem Header="Upload to PlayCanvas" Click="UploadModel_Click"/>
            <Separator/>
            <MenuItem Header="Open File Location" Click="OpenModelFileLocation_Click"/>
            <MenuItem Header="Copy Path" Click="CopyModelPath_Click"/>
            <Separator/>
            <MenuItem Header="Refresh Preview" Click="RefreshModelPreview_Click"/>
        </ContextMenu>

        <!-- ContextMenu для строк материалов -->
        <ContextMenu x:Key="MaterialRowContextMenu">
            <MenuItem Header="Create ORM Texture" Click="CreateORMFromMaterial_Click" FontWeight="Bold"/>
            <MenuItem Header="Create ORM for All Materials" Click="CreateORMForAllMaterials_Click"/>
            <Separator/>
            <MenuItem Header="Delete ORM Texture" Click="DeleteORMTexture_Click"/>
        </ContextMenu>

    </Window.Resources>
    <DockPanel>
        <!-- Статусная строка -->
        <StatusBar DockPanel.Dock="Bottom">
            <StatusBarItem>
                <TextBlock x:Name="ConnectionStatusTextBlock"
                           Text="{Binding ConnectionStatusMessage}"
                           Foreground="{Binding ConnectionStatusBrush}"
                           VerticalAlignment="Center"
                           Width="320"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock x:Name="VersionTextBlock" Text="v1.0.0" VerticalAlignment="Center" Foreground="Gray" FontSize="10" MinWidth="200" TextAlignment="Right"/>
            </StatusBarItem>
        </StatusBar>

        <!-- Прогресс -->
        <Grid DockPanel.Dock="Bottom" HorizontalAlignment="Stretch">
            <ProgressBar x:Name="ProgressBar" Height="16" HorizontalAlignment="Stretch" VerticalAlignment="Center"/>
            <TextBlock x:Name="ProgressTextBlock" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="Black" FontWeight="Bold"/>
        </Grid>

        <!-- Панель управления внизу -->
        <StackPanel DockPanel.Dock="Bottom" Margin="2,4,2,4" Orientation="Horizontal" Width="922" Height="90" VerticalAlignment="Top">
            <!-- Playcanvas Project Connect (Left Side) -->
            <GroupBox Header="Playcanvas Project Connect" HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch" VerticalAlignment="Top" Margin="2,2,2,2" Width="340">
                <StackPanel Orientation="Vertical" Margin="4,2,4,2">
                    <!-- Dynamic Action Button -->
                    <Button x:Name="DynamicConnectionButton"
                            Content="{Binding ConnectionButtonContent}"
                            Command="{Binding PrimaryActionCommand}"
                            Margin="0,2,0,4"
                            Height="24"
                            FontWeight="Bold"
                            ToolTip="{Binding ConnectionButtonToolTip}"/>

                    <!-- Project and Branch Selection -->
                    <StackPanel Orientation="Horizontal">
                        <ComboBox x:Name="ProjectsComboBox"
                                  ItemsSource="{Binding Projects}"
                                  DisplayMemberPath="Value"
                                  SelectedValuePath="Key"
                                  SelectedValue="{Binding SelectedProjectId, Mode=TwoWay}"
                                  SelectionChanged="ProjectsComboBox_SelectionChanged"
                                  Margin="0,0,4,0"
                                  Width="160"
                                  Height="20"
                                  VerticalContentAlignment="Center"
                                  Padding="4,0,4,0"
                                  FontSize="13">
                            <ComboBox.ItemContainerStyle>
                                <Style TargetType="ComboBoxItem">
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                    <Setter Property="VerticalContentAlignment" Value="Center"/>
                                </Style>
                            </ComboBox.ItemContainerStyle>
                        </ComboBox>

                        <ComboBox x:Name="BranchesComboBox"
                                  ItemsSource="{Binding Branches}"
                                  DisplayMemberPath="Name"
                                  SelectedValuePath="Id"
                                  SelectedValue="{Binding SelectedBranchId, Mode=TwoWay}"
                                  SelectionChanged="BranchesComboBox_SelectionChanged"
                                  Width="160"
                                  Height="20"
                                  VerticalContentAlignment="Center"
                                  Padding="4,0,4,0"
                                  FontSize="13">
                            <ComboBox.ItemContainerStyle>
                                <Style TargetType="ComboBoxItem">
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                    <Setter Property="VerticalContentAlignment" Value="Center"/>
                                </Style>
                            </ComboBox.ItemContainerStyle>
                        </ComboBox>
                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <!-- Texture Operations (Right Side) - Only visible for Textures tab -->
            <GroupBox x:Name="TextureOperationsGroupBox" Header="Texture Operations" VerticalAlignment="Top" Margin="2,2,2,2" Width="460" Visibility="Collapsed">
                <StackPanel Orientation="Vertical" Margin="4,2,4,2">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                        <TextBlock Text="Selected:" VerticalAlignment="Center" Margin="0,0,5,0" FontWeight="Bold"/>
                        <TextBlock x:Name="SelectedTexturesCountText" Text="0 textures" VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- Process Buttons -->
                    <StackPanel Orientation="Horizontal" Margin="0,5,0,4">
                        <Button x:Name="ProcessTexturesButton" Content="Process" Width="80" Margin="0,0,5,0"
                                Click="ProcessTexturesButton_Click"
                                ToolTip="Convert selected textures to KTX2 format"
                                IsEnabled="False"/>

                        <Button x:Name="UploadTexturesButton" Content="Upload" Width="80" Margin="0,0,5,0"
                                Click="UploadTexturesButton_Click"
                                ToolTip="Upload converted textures to PlayCanvas (coming soon)"
                                IsEnabled="False"/>

                        <Button x:Name="AutoDetectAllButton" Content="Auto-detect All" Width="110"
                                Click="AutoDetectAllButton_Click"
                                ToolTip="Automatically detect presets for all textures based on filenames"/>

                        <Button x:Name="CreateORMButton" Content="Create ORM" Width="90" Margin="5,0,0,0"
                                Click="CreateORMButton_Click"
                                Background="#FF4CAF50" Foreground="White" FontWeight="Bold"
                                ToolTip="Create virtual ORM texture for channel packing (AO+Gloss+Metallic)"/>
                    </StackPanel>

                    <CheckBox x:Name="ProcessAllCheckBox" Content="Process All" VerticalAlignment="Center"
                              ToolTip="Process all textures instead of just selected ones"
                              Checked="ProcessAllCheckBox_Changed"
                              Unchecked="ProcessAllCheckBox_Changed"/>
                </StackPanel>
            </GroupBox>

            <StackPanel Width="121" Orientation="Horizontal" FlowDirection="RightToLeft" VerticalAlignment="Center">
                <Button Name="CancelButton" Content="Cancel" Click="CancelButton_Click" IsEnabled="False"/>
                <Button Content="Settings" Margin="10,0,10,0" VerticalAlignment="Center" HorizontalAlignment="Center" Background="#FFFBD8C3" Click="Setting"/>
            </StackPanel>
        </StackPanel>

        <Grid DockPanel.Dock="Top" VerticalAlignment="Top">
            <Menu x:Name="menu" VerticalAlignment="Top" Margin="0,0,2,0">
                <MenuItem Header="File">
                    <MenuItem Header="Settings" Click="SettingsMenu"/>
                    <MenuItem Header="Exit" Click="ExitMenu"/>
                </MenuItem>
                <MenuItem Header="Help">
                    <MenuItem Header="About" Click="AboutMenu"/>
                </MenuItem>
            </Menu>
        </Grid>

        <!-- Основной контент -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition x:Name="PreviewColumn" Width="300" MinWidth="256" MaxWidth="512" />
            </Grid.ColumnDefinitions>

            <TabControl x:Name="tabControl" Grid.Column="0" Padding="1,1,1,1" BorderThickness="0,0,0,0" SelectionChanged="TabControl_SelectionChanged">
                <TabItem x:Name="TexturesTabItem" Header="Textures" Height="22" Margin="-2,-2,-2,0" VerticalAlignment="Top">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="4,2,4,2">
                            <CheckBox x:Name="GroupTexturesCheckBox" Content="Group by Type" Margin="0,0,10,0" VerticalAlignment="Center" Checked="GroupTexturesCheckBox_Changed" Unchecked="GroupTexturesCheckBox_Changed"/>
                            <TextBlock Text="Scale:" VerticalAlignment="Center" Margin="10,0,5,0"/>
                            <Slider x:Name="TexturesScaleSlider" Width="120" Minimum="0.5" Maximum="2.0"
                                    Value="{Binding Source={x:Static settings:AppSettings.Default}, Path=TexturesTableScale, Mode=TwoWay}"
                                    TickFrequency="0.1" IsSnapToTickEnabled="True" VerticalAlignment="Center"
                                    ToolTip="Adjust table scale (50% - 200%)"/>
                            <TextBlock Text="{Binding ElementName=TexturesScaleSlider, Path=Value, StringFormat={}{0:P0}}"
                                       VerticalAlignment="Center" Margin="5,0,0,0" MinWidth="40"/>
                        </StackPanel>
                        <DataGrid x:Name="TexturesDataGrid" Grid.Row="1"
                                AutoGenerateColumns="False"
                                SelectionChanged="TexturesDataGrid_SelectionChanged"
                                LoadingRow="TexturesDataGrid_LoadingRow"
                                Sorting="TexturesDataGrid_Sorting"
                                IsReadOnly="True"
                                CanUserAddRows="False"
                                CanUserDeleteRows="False"
                                CanUserSortColumns="True"
                                CanUserResizeColumns="True"
                                CanUserReorderColumns="True"
                                Background="#FFD6D6D6"
                                VirtualizingPanel.IsVirtualizing="True"
                                VirtualizingPanel.VirtualizationMode="Standard"
                                EnableRowVirtualization="True"
                                EnableColumnVirtualization="False">
                            <DataGrid.LayoutTransform>
                                <ScaleTransform ScaleX="{Binding ElementName=TexturesScaleSlider, Path=Value}"
                                                ScaleY="{Binding ElementName=TexturesScaleSlider, Path=Value}"/>
                            </DataGrid.LayoutTransform>
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="ContextMenu" Value="{StaticResource TextureColumnHeaderContextMenu}"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                            <DataGrid.RowStyle>
                                <Style TargetType="DataGridRow">
                                    <Setter Property="ContextMenu" Value="{StaticResource TextureRowContextMenu}"/>
                                    <Style.Triggers>
                                        <!-- Color ORM textures with pink/purple background (like Normal maps) -->
                                        <DataTrigger Binding="{Binding IsORMTexture}" Value="True">
                                            <Setter Property="Background" Value="#C96391"/>
                                            <Setter Property="BorderBrush" Value="#A04070"/>
                                            <Setter Property="BorderThickness" Value="2,0,2,0"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.RowStyle>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="№" Binding="{Binding Index}" IsReadOnly="True" Width="50" MinWidth="40" />
                                <DataGridTextColumn Header="ID" Binding="{Binding ID}" IsReadOnly="True" Width="80" MinWidth="60" />
                                <DataGridTextColumn Header="Texture Name" Binding="{Binding Name}" IsReadOnly="True" Width="200" MinWidth="100"/>
                                <DataGridTextColumn Header="Extension" Binding="{Binding Extension}" IsReadOnly="True" Width="70" MinWidth="50"/>
                                <DataGridTextColumn Header="Size" Binding="{Binding Size, Converter={StaticResource SizeConverter}}" IsReadOnly="True" Width="80" MinWidth="60"/>
                                <DataGridTextColumn Header="Compressed" Binding="{Binding CompressedSize, Converter={StaticResource SizeConverter}}" IsReadOnly="True" Width="90" MinWidth="70"/>
                                <DataGridTextColumn Header="Resolution" Binding="{Binding Resolution, Converter={StaticResource ResolutionConverter}}" IsReadOnly="True" Width="100" MinWidth="80" SortMemberPath="ResolutionArea"/>
                                <DataGridTextColumn Header="Resize Resolution" Binding="{Binding ResizeResolution, Converter={StaticResource ResolutionConverter}}" IsReadOnly="True" Width="120" MinWidth="100" SortMemberPath="ResizeResolutionArea"/>
                                <DataGridTextColumn Header="Compression" Binding="{Binding CompressionFormat}" IsReadOnly="True" Width="100" MinWidth="80"/>
                                <DataGridTextColumn Header="Mipmaps" Binding="{Binding MipmapCount}" IsReadOnly="True" Width="70" MinWidth="60"/>
                                <DataGridTextColumn Header="Preset" Binding="{Binding PresetName}" IsReadOnly="True" Width="120" MinWidth="90"/>
                                <DataGridTemplateColumn Header="Status/Progress" Width="*" MinWidth="150" SortMemberPath="Status">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Grid>
                                                <ProgressBar MinWidth="100" Width="auto" Minimum="0" Maximum="100" Value="{Binding DownloadProgress}" Visibility="{Binding Status, Converter={StaticResource StatusToVisibilityConverter}}"/>
                                                <TextBlock Text="{Binding Status}" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="Black" Background="{Binding Status, Converter={StaticResource StatusToBackgroundConverter}}"/>
                                            </Grid>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                            <DataGrid.GroupStyle>
                                <GroupStyle>
                                    <GroupStyle.HeaderTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal" Margin="2,0,0,0">
                                                <TextBlock Text="{Binding Name}" FontWeight="Bold" FontSize="11" Margin="0,0,4,0"/>
                                                <TextBlock Text="(" FontSize="10" Foreground="#FF666666"/>
                                                <TextBlock Text="{Binding ItemCount}" FontSize="10" Foreground="#FF666666"/>
                                                <TextBlock Text=")" FontSize="10" Foreground="#FF666666"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </GroupStyle.HeaderTemplate>
                                    <GroupStyle.ContainerStyle>
                                        <Style TargetType="{x:Type GroupItem}">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="{x:Type GroupItem}">
                                                        <Expander IsExpanded="True" Background="#FFE8E8E8" BorderBrush="#FFCCCCCC" BorderThickness="1" Margin="0,1,0,1" Padding="0">
                                                            <Expander.Header>
                                                                <ContentPresenter Content="{TemplateBinding Content}" Margin="2,2,2,2"/>
                                                            </Expander.Header>
                                                            <Expander.Style>
                                                                <Style TargetType="Expander">
                                                                    <Setter Property="Margin" Value="0"/>
                                                                    <Setter Property="Padding" Value="0"/>
                                                                </Style>
                                                            </Expander.Style>
                                                            <ItemsPresenter Margin="0"/>
                                                        </Expander>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </GroupStyle.ContainerStyle>
                                </GroupStyle>
                            </DataGrid.GroupStyle>
                        </DataGrid>
                    </Grid>
                </TabItem>
                <TabItem Header="Models">
                    <Grid Background="#FFE5E5E5">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="4,2,4,2">
                            <TextBlock Text="Scale:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <Slider x:Name="ModelsScaleSlider" Width="120" Minimum="0.5" Maximum="2.0"
                                    Value="{Binding Source={x:Static settings:AppSettings.Default}, Path=ModelsTableScale, Mode=TwoWay}"
                                    TickFrequency="0.1" IsSnapToTickEnabled="True" VerticalAlignment="Center"
                                    ToolTip="Adjust table scale (50% - 200%)"/>
                            <TextBlock Text="{Binding ElementName=ModelsScaleSlider, Path=Value, StringFormat={}{0:P0}}"
                                       VerticalAlignment="Center" Margin="5,0,0,0" MinWidth="40"/>
                        </StackPanel>
                        <DataGrid x:Name="ModelsDataGrid" Grid.Row="1"
                              AutoGenerateColumns="False"
                              SelectionChanged="ModelsDataGrid_SelectionChanged"
                              IsReadOnly="True"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              CanUserSortColumns="True"
                              CanUserResizeColumns="True"
                              CanUserReorderColumns="True"
                              Background="#FFD6D6D6"
                              VirtualizingPanel.IsVirtualizing="True"
                              VirtualizingPanel.VirtualizationMode="Recycling"
                              EnableRowVirtualization="True"
                              EnableColumnVirtualization="True">
                            <DataGrid.LayoutTransform>
                                <ScaleTransform ScaleX="{Binding ElementName=ModelsScaleSlider, Path=Value}"
                                                ScaleY="{Binding ElementName=ModelsScaleSlider, Path=Value}"/>
                            </DataGrid.LayoutTransform>
                            <DataGrid.RowStyle>
                                <Style TargetType="DataGridRow">
                                    <Setter Property="ContextMenu" Value="{StaticResource ModelRowContextMenu}"/>
                                </Style>
                            </DataGrid.RowStyle>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="№" Binding="{Binding Index}" IsReadOnly="True" Width="50" MinWidth="40" />
                                <DataGridTextColumn Header="ID" Binding="{Binding ID}" Width="80" MinWidth="60" />
                                <DataGridTextColumn Header="Model Name" Binding="{Binding Name}" Width="250" MinWidth="120"/>
                                <DataGridTextColumn Header="Size" Binding="{Binding Size, Converter={StaticResource SizeConverter}}" Width="80" MinWidth="60"/>
                                <DataGridTextColumn Header="UV Channels" Binding="{Binding UVChannels}" Width="100" MinWidth="80"/>
                                <DataGridTextColumn Header="Extension" Binding="{Binding Extension}" Width="80" MinWidth="60"/>
                                <DataGridTemplateColumn Header="Status/Progress" Width="*" MinWidth="150" SortMemberPath="Status">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Grid>
                                                <ProgressBar MinWidth="100" Width="auto" Minimum="0" Maximum="100" Value="{Binding DownloadProgress}" Visibility="{Binding Status, Converter={StaticResource StatusToVisibilityConverter}}"/>
                                                <TextBlock Text="{Binding Status}" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="Black" Background="{Binding Status, Converter={StaticResource StatusToBackgroundConverter}}"/>
                                            </Grid>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </TabItem>
                <TabItem x:Name="MaterialsTabItem" Header="Materials">
                    <Grid Background="#FFE5E5E5">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="4,2,4,2">
                            <TextBlock Text="Scale:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <Slider x:Name="MaterialsScaleSlider" Width="120" Minimum="0.5" Maximum="2.0"
                                    Value="{Binding Source={x:Static settings:AppSettings.Default}, Path=MaterialsTableScale, Mode=TwoWay}"
                                    TickFrequency="0.1" IsSnapToTickEnabled="True" VerticalAlignment="Center"
                                    ToolTip="Adjust table scale (50% - 200%)"/>
                            <TextBlock Text="{Binding ElementName=MaterialsScaleSlider, Path=Value, StringFormat={}{0:P0}}"
                                       VerticalAlignment="Center" Margin="5,0,0,0" MinWidth="40"/>
                        </StackPanel>
                    <DataGrid x:Name="MaterialsDataGrid" Grid.Row="1"
                              AutoGenerateColumns="False"
                              ItemsSource="{Binding Materials}"
                              SelectionChanged="MaterialsDataGrid_SelectionChanged"
                              IsReadOnly="True"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              CanUserSortColumns="True"
                              CanUserResizeColumns="True"
                              CanUserReorderColumns="True"
                              Background="#FFD6D6D6"
                              VirtualizingPanel.IsVirtualizing="True"
                              VirtualizingPanel.VirtualizationMode="Recycling"
                              EnableRowVirtualization="True"
                              EnableColumnVirtualization="True">
                        <DataGrid.LayoutTransform>
                            <ScaleTransform ScaleX="{Binding ElementName=MaterialsScaleSlider, Path=Value}"
                                            ScaleY="{Binding ElementName=MaterialsScaleSlider, Path=Value}"/>
                        </DataGrid.LayoutTransform>
                        <DataGrid.ContextMenu>
                            <ContextMenu>
                                <MenuItem Header="Columns Visibility">
                                    <MenuItem Header="ID" IsCheckable="True" IsChecked="True" Click="MaterialColumnVisibility_Click" Tag="ID"/>
                                    <MenuItem Header="Name" IsCheckable="True" IsChecked="True" Click="MaterialColumnVisibility_Click" Tag="Name"/>
                                    <MenuItem Header="Status/Progress" IsCheckable="True" IsChecked="True" Click="MaterialColumnVisibility_Click" Tag="Status"/>
                                </MenuItem>
                            </ContextMenu>
                        </DataGrid.ContextMenu>
                        <DataGrid.RowStyle>
                            <Style TargetType="DataGridRow">
                                <Setter Property="ContextMenu" Value="{StaticResource MaterialRowContextMenu}"/>
                            </Style>
                        </DataGrid.RowStyle>
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="№" Binding="{Binding Index}" IsReadOnly="True" Width="50" MinWidth="40"/>
                            <DataGridTextColumn Header="ID" Binding="{Binding ID}" IsReadOnly="True" Width="80" MinWidth="60" />
                            <DataGridTextColumn Header="Name" Binding="{Binding Name}" IsReadOnly="True" Width="300" MinWidth="150"/>
                            <DataGridTemplateColumn Header="Status/Progress" Width="*" MinWidth="150" SortMemberPath="Status">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <ProgressBar MinWidth="100" Width="auto" Minimum="0" Maximum="100" Value="{Binding DownloadProgress}" Visibility="{Binding Status, Converter={StaticResource StatusToVisibilityConverter}}"/>
                                            <TextBlock Text="{Binding Status}" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="Black" Background="{Binding Status, Converter={StaticResource StatusToBackgroundConverter}}"/>
                                        </Grid>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                    </Grid>
                </TabItem>
                <TabItem x:Name="LogsTabItem" Header="Logs" Height="22" Margin="-2,-2,-2,0" VerticalAlignment="Top">
                    <controls:LogViewerControl x:Name="LogViewer"/>
                </TabItem>
            </TabControl>

            <GridSplitter Grid.Column="1" Width="7" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" ResizeBehavior="PreviousAndNext" Background="Gray" FontSize="6"/>

            <Button x:Name="ToggleViewButton" Grid.Column="1" Content="►"
                Click="ToggleViewerButton_Click" Background="White" Padding="0,0,0,0" Grid.RowSpan="1" VerticalContentAlignment="Center" HorizontalContentAlignment="Center" Height="32" Width="7" BorderThickness="0,0,0,0" VerticalAlignment="Center" MinWidth="0" MinHeight="0" FontSize="6" FontFamily="Arial" Foreground="#FFFF8F07"/>

            <ScrollViewer x:Name="TextureViewerScroll" Grid.Column="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Visibility="Visible" SizeChanged="TextureViewerScroll_SizeChanged">
                <Border x:Name="TextureViewer" Background="#FFFFFF" BorderThickness="2,2,2,2" Padding="0,0,0,0" MinWidth="128" MinHeight="128">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <!-- Preview Section -->
                        <Expander Grid.Row="0" Header="Preview" IsExpanded="True" Style="{StaticResource CompactExpanderStyle}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition x:Name="PreviewContentRow" Height="300" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <!-- Texture Info Panel (ABOVE viewport to avoid HwndHost airspace issue) -->
                                <Border Grid.Row="0" Background="#DD000000" BorderThickness="0,0,0,1" BorderBrush="#FF555555" Padding="6,4">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0" Orientation="Vertical" Margin="0,0,12,0">
                                            <TextBlock x:Name="TextureNameTextBlock"
                                                      Text="Texture Name:"
                                                      Foreground="White"
                                                      FontSize="10"
                                                      FontWeight="SemiBold"
                                                      Margin="0,0,0,2" />
                                            <TextBlock x:Name="TextureResolutionTextBlock"
                                                      Text="Resolution:"
                                                      Foreground="#FFCCCCCC"
                                                      FontSize="9"
                                                      Margin="0,0,0,1" />
                                        </StackPanel>

                                        <StackPanel Grid.Column="1" Orientation="Vertical">
                                            <TextBlock x:Name="TextureSizeTextBlock"
                                                      Text="Size:"
                                                      Foreground="#FFCCCCCC"
                                                      FontSize="9"
                                                      Margin="0,0,0,1" />
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock x:Name="TextureColorSpaceTextBlock"
                                                          Text="Color Space:"
                                                          Foreground="#FFAAAAAA"
                                                          FontSize="9"
                                                          Margin="0,0,8,0" />
                                                <TextBlock x:Name="TextureFormatTextBlock"
                                                          Text="Format:"
                                                          Foreground="#FFAAAAAA"
                                                          FontSize="9" />
                                            </StackPanel>
                                        </StackPanel>
                                    </Grid>
                                </Border>

                                <!-- Texture Viewport -->
                                <Border Grid.Row="1" BorderBrush="Black" BorderThickness="1" Margin="0" MinWidth="128" MinHeight="128" MaxHeight="512">
                                    <Grid x:Name="TexturePreviewViewport"
                                          Background="#FF333333"
                                          ClipToBounds="True"
                                          SizeChanged="TexturePreviewViewport_SizeChanged"
                                          MouseWheel="D3D11TextureViewer_PreviewMouseWheel"
                                          MouseEnter="TexturePreviewViewport_MouseEnter"
                                          Focusable="True">
                                        <!-- D3D11 Texture Viewer (GPU-accelerated, default) -->
                                        <viewer:D3D11TextureViewerControl x:Name="D3D11TextureViewer"
                                                                           Visibility="Visible" />

                                        <!-- WPF Image Viewer (software fallback, legacy mode) -->
                                        <Image x:Name="WpfTexturePreviewImage"
                                               Stretch="Uniform"
                                               RenderOptions.BitmapScalingMode="HighQuality"
                                               Visibility="Collapsed" />
                                    </Grid>
                                </Border>

                                <GridSplitter Grid.Row="2"
                                              Height="6"
                                              Margin="0,4,0,4"
                                              Background="#FFE0E0E0"
                                              HorizontalAlignment="Stretch"
                                              ResizeDirection="Rows"
                                              ResizeBehavior="PreviousAndNext"
                                              ShowsPreview="False"
                                              Cursor="SizeNS"
                                              DragDelta="PreviewHeightGridSplitter_DragDelta" />

                                <StackPanel x:Name="ChannelButtonsPanel" Grid.Row="3" Orientation="Vertical" HorizontalAlignment="Left" Margin="6,4,6,6">
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,6" VerticalAlignment="Center">
                                        <TextBlock Text="Источник превью:" FontSize="10" VerticalAlignment="Center" />
                                        <RadioButton x:Name="PreviewSourceOriginalRadioButton"
                                                     Content="Source"
                                                     GroupName="TexturePreviewSource"
                                                     Margin="8,0,0,0"
                                                     Checked="PreviewSourceRadioButton_Checked" />
                                        <RadioButton x:Name="PreviewSourceKtxRadioButton"
                                                     Content="KTX2"
                                                     GroupName="TexturePreviewSource"
                                                     Margin="8,0,0,0"
                                                     Checked="PreviewSourceRadioButton_Checked" />
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" Height="20" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="0,0,0,6" RenderTransformOrigin="0.5,0.5">
                                        <StackPanel.RenderTransform>
                                            <TransformGroup>
                                                <ScaleTransform ScaleX="1"/>
                                                <SkewTransform/>
                                                <RotateTransform/>
                                                <TranslateTransform/>
                                            </TransformGroup>
                                        </StackPanel.RenderTransform>
                                        <ToggleButton x:Name="RChannelButton" Content="R" Tag="R" Width="30" Height="20" Background="#FFCE3737" Click="FilterButton_Click" BorderBrush="Black"/>
                                        <ToggleButton x:Name="GChannelButton" Content="G" Tag="G" Width="30" Height="20" Background="#FF73CE37" Click="FilterButton_Click" BorderBrush="Black"/>
                                        <ToggleButton x:Name="BChannelButton" Content="B" Tag="B" Width="30" Height="20" Background="#FF3785CE" Click="FilterButton_Click" BorderBrush="Black"/>
                                        <ToggleButton x:Name="AChannelButton" Content="A" Tag="A" Width="30" Height="20" Background="Gray" Foreground="White" Click="FilterButton_Click" HorizontalContentAlignment="Center" BorderThickness="1,1,1,1" BorderBrush="Black"/>
                                        <ToggleButton x:Name="NormalButton" Content="Nrm" Tag="Normal" Width="35" Height="20" Background="#FF4488FF" Foreground="White" Click="FilterButton_Click" HorizontalContentAlignment="Center" BorderThickness="1,1,1,1" BorderBrush="Black" Margin="2,0,0,0"/>

                                        <!-- Fit/Reset button -->
                                        <Button x:Name="FitResetButton" Content="Fit" Width="35" Height="20" Margin="4,0,0,0" Background="#FFE0E0E0" Click="FitResetButton_Click" BorderBrush="Black" FontSize="10" Padding="2"/>

                                        <!-- Filter toggle button (Point/Trilinear) -->
                                        <ToggleButton x:Name="FilterToggleButton" Content="Filter" Width="45" Height="20" Margin="4,0,0,0" Background="#FFE0E0E0" IsChecked="True" Click="FilterToggleButton_Click" BorderBrush="Black" FontSize="9" Padding="2"/>

                                        <!-- Histogram correction toggle button -->
                                        <ToggleButton x:Name="HistogramCorrectionButton" Content="Hist" Width="35" Height="20" Margin="4,0,0,0" Background="#FFFFD700" IsChecked="True" Click="HistogramCorrectionButton_Click" BorderBrush="Black" FontSize="9" Padding="2" ToolTip="Histogram preprocessing compensation (denormalization)"/>
                                    </StackPanel>
                                    <Border x:Name="MipmapSliderPanel" Margin="0,6,0,0" Background="#AAFFFFFF" Padding="4" Visibility="Collapsed" HorizontalAlignment="Left">
                                        <StackPanel Orientation="Vertical">
                                            <TextBlock x:Name="MipmapInfoTextBlock" Text="Уровень мипа" FontSize="10" Margin="0,0,0,4" />
                                            <Slider x:Name="MipmapLevelSlider"
                                                    Minimum="0"
                                                    Maximum="0"
                                                    TickFrequency="1"
                                                    IsSnapToTickEnabled="True"
                                                    AutoToolTipPlacement="TopLeft"
                                                    AutoToolTipPrecision="0"
                                                    ValueChanged="MipmapLevelSlider_ValueChanged"
                                                    Width="220" />
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </Grid>
                        </Expander>

                        <!-- Histogram Section -->
                        <Expander Grid.Row="1" Header="Histogram" IsExpanded="True" Style="{StaticResource CompactExpanderStyle}">
                            <StackPanel Orientation="Vertical">
                                <!-- Histogram Plot -->
                                <Border BorderBrush="Black" BorderThickness="1" Margin="0,0,0,4" Height="128">
                                    <oxy:PlotView x:Name="HistogramPlotView" Height="128" VerticalContentAlignment="Center" HorizontalContentAlignment="Center" Padding="0,0,0,0" />
                                </Border>

                                <!-- Histogram Statistics -->
                                <Border BorderBrush="#CCCCCC" BorderThickness="1" Background="#F5F5F5" Padding="6,4">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- Row 1 -->
                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Min:" FontSize="9" FontWeight="SemiBold" Margin="0,0,4,2"/>
                                        <TextBlock x:Name="HistogramMinTextBlock" Grid.Row="0" Grid.Column="1" Text="0" FontSize="9" Margin="0,0,8,2"/>

                                        <TextBlock Grid.Row="0" Grid.Column="2" Text="Max:" FontSize="9" FontWeight="SemiBold" Margin="0,0,4,2"/>
                                        <TextBlock x:Name="HistogramMaxTextBlock" Grid.Row="0" Grid.Column="3" Text="255" FontSize="9" Margin="0,0,0,2"/>

                                        <!-- Row 2 -->
                                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Mean:" FontSize="9" FontWeight="SemiBold" Margin="0,0,4,2"/>
                                        <TextBlock x:Name="HistogramMeanTextBlock" Grid.Row="1" Grid.Column="1" Text="127.5" FontSize="9" Margin="0,0,8,2"/>

                                        <TextBlock Grid.Row="1" Grid.Column="2" Text="Median:" FontSize="9" FontWeight="SemiBold" Margin="0,0,4,2"/>
                                        <TextBlock x:Name="HistogramMedianTextBlock" Grid.Row="1" Grid.Column="3" Text="128" FontSize="9" Margin="0,0,0,2"/>

                                        <!-- Row 3 -->
                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="StdDev:" FontSize="9" FontWeight="SemiBold" Margin="0,0,4,0"/>
                                        <TextBlock x:Name="HistogramStdDevTextBlock" Grid.Row="2" Grid.Column="1" Text="45.2" FontSize="9" Margin="0,0,8,0"/>

                                        <TextBlock Grid.Row="2" Grid.Column="2" Text="Pixels:" FontSize="9" FontWeight="SemiBold" Margin="0,0,4,0"/>
                                        <TextBlock x:Name="HistogramPixelsTextBlock" Grid.Row="2" Grid.Column="3" Text="0" FontSize="9" Margin="0,0,0,0"/>
                                    </Grid>
                                </Border>
                            </StackPanel>
                        </Expander>

                        <!-- Conversion Settings Panel -->
                        <Expander Grid.Row="2" x:Name="ConversionSettingsExpander" Header="Conversion Settings"
                                  Style="{StaticResource CompactExpanderStyle}" IsExpanded="True"
                                  Expanded="ConversionSettingsExpander_Expanded"
                                  Collapsed="ConversionSettingsExpander_Collapsed">
                            <controls:TextureConversionSettingsPanel x:Name="ConversionSettingsPanel"
                                                                     SettingsChanged="ConversionSettingsPanel_SettingsChanged"/>
                        </Expander>

                        <!-- ORM Packing Panel (only visible when ORM texture is selected) -->
                        <controls:ORMPackingPanel Grid.Row="3"
                                                  x:Name="ORMPanel"
                                                  Visibility="Collapsed"
                                                  Margin="0,2,0,0"/>
                    </Grid>
                </Border>
            </ScrollViewer>

            <ScrollViewer x:Name="ModelViewerScroll" Grid.Column="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Visibility="Collapsed">
                <Border x:Name="ModelViewer" Background="#FFFFFF" BorderThickness="2,2,2,2" Padding="0,0,0,0" MinWidth="128" MinHeight="128">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition x:Name="ModelPreviewRow" Height="400" MinHeight="200" MaxHeight="800" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" MinHeight="150" />
                        </Grid.RowDefinitions>

                        <!-- Model Preview Section -->
                        <Expander Grid.Row="0" Header="Model Preview" IsExpanded="True" Style="{StaticResource CompactExpanderStyle}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>

                                <!-- Model Info Panel (ABOVE viewport) -->
                                <Border Grid.Row="0" Background="#DD000000" BorderThickness="0,0,0,1" BorderBrush="#FF555555" Padding="6,4">
                                    <StackPanel Orientation="Vertical">
                                        <TextBlock x:Name="ModelNameTextBlock"
                                                  Text="Model Name:"
                                                  Foreground="White"
                                                  FontSize="10"
                                                  FontWeight="SemiBold"
                                                  Margin="0,0,0,2" />
                                        <TextBlock x:Name="ModelTrianglesTextBlock"
                                                  Text="Triangles:"
                                                  Foreground="#FFCCCCCC"
                                                  FontSize="9"
                                                  Margin="0,0,0,1" />
                                        <TextBlock x:Name="ModelVerticesTextBlock"
                                                  Text="Vertices:"
                                                  Foreground="#FFCCCCCC"
                                                  FontSize="9"
                                                  Margin="0,0,0,1" />
                                        <TextBlock x:Name="ModelUVChannelsTextBlock"
                                                  Text="UV Channels:"
                                                  Foreground="#FFAAAAAA"
                                                  FontSize="9" />
                                    </StackPanel>
                                </Border>

                                <!-- 3D Viewport -->
                                <Border Grid.Row="1" Background="#FF414D58" BorderBrush="Black" BorderThickness="1" Margin="0" MinWidth="128" MinHeight="128">
                                    <helix:HelixViewport3D x:Name="viewPort3d" ZoomExtentsWhenLoaded="true">
                                        <helix:DefaultLights/>
                                    </helix:HelixViewport3D>
                                </Border>
                            </Grid>
                        </Expander>

                        <!-- GridSplitter between Model Preview and bottom section -->
                        <GridSplitter x:Name="ModelPreviewGridSplitter"
                                      Grid.Row="1"
                                      Height="6"
                                      Margin="0,4,0,4"
                                      Background="#FFE0E0E0"
                                      HorizontalAlignment="Stretch"
                                      VerticalAlignment="Center"
                                      ResizeDirection="Rows"
                                      ResizeBehavior="PreviousAndNext"
                                      ShowsPreview="False"
                                      Cursor="SizeNS"
                                      DragCompleted="ModelPreviewGridSplitter_DragCompleted" />

                        <!-- Bottom section: UV Maps + Settings -->
                        <Grid Grid.Row="2">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                        <!-- UV Maps Section -->
                        <Expander Grid.Row="0" Header="UV Maps" IsExpanded="False" Style="{StaticResource CompactExpanderStyle}">
                            <Border BorderBrush="Black" BorderThickness="1" Margin="0" MinWidth="128" MinHeight="137" MaxHeight="300">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Text="UV Map 1" HorizontalAlignment="Center" Margin="0,5,0,5" FontWeight="Bold" Foreground="#7F000000"/>
                                        <Viewbox Stretch="Uniform" MinWidth="128" MinHeight="128" Grid.Row="1">
                                            <Image x:Name="UVImage" Stretch="Uniform" MinWidth="128" MinHeight="128" />
                                        </Viewbox>
                                    </Grid>
                                    <Grid Grid.Column="1">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Text="UV Map 2" HorizontalAlignment="Center" Margin="0,5,0,5" FontWeight="Bold" Foreground="#7F000000"/>
                                        <Viewbox Stretch="Uniform" MinWidth="128" MinHeight="128" Grid.Row="1">
                                            <Image x:Name="UVImage2" Stretch="Uniform" MinWidth="128" MinHeight="128" />
                                        </Viewbox>
                                    </Grid>
                                </Grid>
                            </Border>
                        </Expander>

                        <!-- Model Conversion Settings Panel -->
                        <Expander Grid.Row="1" x:Name="ModelConversionSettingsExpander" Header="Model Conversion Settings"
                                  Style="{StaticResource CompactExpanderStyle}" IsExpanded="True">
                            <controls:ModelConversionSettingsPanel x:Name="ModelConversionSettingsPanel"
                                                                   ProcessRequested="ModelConversionSettingsPanel_ProcessRequested"/>
                        </Expander>
                        </Grid>
                    </Grid>
                </Border>
            </ScrollViewer>

            <!-- Просмотр параметров материала -->
            <ScrollViewer x:Name="MaterialViewerScroll" Grid.Column="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Visibility="Collapsed">
                <Border x:Name="MaterialViewer" Background="#FFE1E1E1" Margin="2,2,2,2" Padding="2,2,2,2" CornerRadius="4,4,4,4" BorderThickness="1,1,1,1" BorderBrush="Black" MinWidth="256">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock x:Name="MaterialIDTextBlock" Text="ID: " Margin="4,0,4,0" FontWeight="Bold" />
                            <TextBlock x:Name="MaterialNameTextBlock" Text="Name: " Margin="4,0,4,0" FontWeight="Bold" />
                        </StackPanel>

                        <!-- ORM Texture Creation -->
                        <Button x:Name="CreateORMFromMaterialButton"
                                Content="Create ORM Texture"
                                Click="CreateORMFromMaterial_Click"
                                Margin="4,8,4,8"
                                Padding="8,4"
                                Background="#FF4CAF50"
                                Foreground="White"
                                FontWeight="Bold"
                                HorizontalAlignment="Stretch"
                                ToolTip="Create packed ORM texture from material maps (AO+Gloss+Metallic)"/>

                        <Expander x:Name="AOExpander" Header="Ambient Occlusion" VerticalAlignment="Top" FontSize="10" VerticalContentAlignment="Top" FontWeight="Bold" Padding="2,2,4,4" BorderThickness="1,1,1,1" BorderBrush="Black" Background="White" IsExpanded="True" Margin="2,2,2,3">
                            <StackPanel>
                                <Border BorderThickness="1,1,1,1" CornerRadius="2,2,2,2" Panel.ZIndex="1" BorderBrush="Black" Padding="2,2,2,2">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Margin="4,0,4,0" VerticalAlignment="Center" Grid.Column="0">
                                    <Hyperlink x:Name="MaterialAOMapHyperlink" Click="MaterialAOMapHyperlink_Click" Style="{StaticResource TextureHyperlinkStyle}">
                                        No AO Map
                                    </Hyperlink>
                                        </TextBlock>
                                        <Border BorderThickness="1,1,1,1" CornerRadius="1,1,1,1" Panel.ZIndex="1" BorderBrush="Black" Width="64" Height="64" Grid.Column="1">
                                            <Image x:Name="TextureAOPreviewImage" RenderOptions.EdgeMode="Aliased" RenderOptions.BitmapScalingMode="HighQuality" MaxWidth="64" MaxHeight="64" HorizontalAlignment="Center" VerticalAlignment="Center" Cursor="Hand" Tag="AO" MouseLeftButtonUp="TexturePreview_MouseLeftButtonUp"/>
                                        </Border>
                                    </Grid>
                                </Border>

                                <Grid Margin="0,2,0,2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="AO UV Channel" FontWeight="Bold" Margin="4,2,4,2" HorizontalAlignment="Left" VerticalAlignment="Center" Grid.Column="0"/>
                                    <ComboBox x:Name="MaterialAOUVChannelComboBox" SelectedIndex="0" Width="50" HorizontalAlignment="Right" VerticalAlignment="Bottom" Grid.Column="1" Height="20" Margin="4,0,4,0"/>
                                </Grid>

                                <Grid Margin="0,2,0,2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="AO Color Channel" FontWeight="Bold" Margin="4,2,4,2" HorizontalAlignment="Left" VerticalAlignment="Center" Grid.Column="0"/>

                                    <ComboBox x:Name="MaterialAOColorChannelComboBox" SelectedIndex="0" Grid.Column="1" HorizontalAlignment="Right" MinWidth="50" Margin="4,0,4,0" BorderThickness="1,1,1,1" Height="20">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="{Binding Converter={StaticResource ChannelColorConverter}, ConverterParameter=Background}" BorderThickness="0">
                                                    <TextBlock Text="{Binding}" Foreground="{Binding Converter={StaticResource ChannelColorConverter}, ConverterParameter=Foreground}"/>
                                                </Border>
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                        <ComboBox.ItemContainerStyle>
                                            <Style TargetType="ComboBoxItem">
                                                <Setter Property="Background" Value="{Binding Converter={StaticResource ChannelColorConverter}, ConverterParameter=Background}"/>
                                                <Setter Property="Foreground" Value="{Binding Converter={StaticResource ChannelColorConverter}, ConverterParameter=Foreground}"/>
                                                <Setter Property="BorderThickness" Value="0"/>
                                            </Style>
                                        </ComboBox.ItemContainerStyle>
                                        <ComboBox.Style>
                                            <Style TargetType="ComboBox">
                                                <Setter Property="Background" Value="{Binding RelativeSource={RelativeSource Self}, Path=SelectedItem, Converter={StaticResource ChannelColorConverter}, ConverterParameter=Background}"/>
                                                <Setter Property="Foreground" Value="{Binding RelativeSource={RelativeSource Self}, Path=SelectedItem, Converter={StaticResource ChannelColorConverter}, ConverterParameter=Foreground}"/>
                                                <Setter Property="BorderThickness" Value="0"/>
                                            </Style>
                                        </ComboBox.Style>
                                    </ComboBox>

                                </Grid>

                                <Grid Margin="0,2,0,2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Occlude Specular" FontWeight="Bold" Margin="4,2,4,2" HorizontalAlignment="Left" VerticalAlignment="Center" Grid.Column="0"/>
                                    <ComboBox x:Name="MaterialAOOccludeSpecularComboBox" SelectedIndex="0" Width="100" Margin="4,0,4,0" HorizontalAlignment="Right" VerticalAlignment="Center" Grid.Column="1" Height="20">
                                        <ComboBox.Background>
                                            <LinearGradientBrush EndPoint="0,1">
                                                <GradientStop Color="#FFF0F0F0"/>
                                                <GradientStop Color="Gray" Offset="1"/>
                                            </LinearGradientBrush>
                                        </ComboBox.Background>
                                    </ComboBox>
                                </Grid>

                                <!-- AO Tint -->
                                <Border BorderThickness="1,1,1,1" BorderBrush="Black" CornerRadius="2,2,2,2">
                                    <StackPanel Margin="4,2,4,2" HorizontalAlignment="Left" VerticalAlignment="Top">
                                        <CheckBox x:Name="MaterialAOTintCheckBox" Content="AO Tint" Margin="4,2,4,2" HorizontalAlignment="Left" VerticalAlignment="Center" VerticalContentAlignment="Center" Padding="4,1,0,0" FlowDirection="RightToLeft"/>
                                        <Grid Margin="0,2,0,2">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="AO Tint Color" Margin="4,2,4,2" HorizontalAlignment="Left" VerticalAlignment="Center" Grid.Column="0"/>
                                            <TextBox x:Name="MaterialAOTintColorRect" BorderBrush="Black" Width="64" Height="19" Margin="2,1,0,1" HorizontalAlignment="Center" VerticalAlignment="Center" Background="#FF678ADE" BorderThickness="1,1,1,1" Text="#ffffff00" Foreground="#E5000000" IsReadOnly="True" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Grid.Column="1"/>
                                            <xctk:ColorPicker x:Name="AOTintColorPicker" SelectedColorChanged="AOTintColorPicker_SelectedColorChanged" Width="20" Height="20" AvailableColorsSortingMode="HueSaturationBrightness" HorizontalContentAlignment="Left" VerticalContentAlignment="Center" RenderTransformOrigin="0.5,0.5" FontSize="10" HorizontalAlignment="Left" VerticalAlignment="Top" ColorMode="ColorCanvas" BorderThickness="0,0,0,0" ShowRecentColors="True" Panel.ZIndex="1" Grid.Column="2"/>
                                        </Grid>
                                        <CheckBox x:Name="MaterialAOVertexColorCheckBox" Content="AO Vertex Color" Margin="4,0,4,0" HorizontalAlignment="Left" VerticalAlignment="Center" VerticalContentAlignment="Center" Padding="4,1,0,0" FlowDirection="RightToLeft"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Expander>

                        <Expander x:Name="DiffuseExpander" Header="Diffuse" VerticalAlignment="Top" FontSize="10" VerticalContentAlignment="Top" FontWeight="Bold" Padding="2,2,4,4" BorderThickness="1,1,1,1" BorderBrush="Black" Background="#FFB1B1B1" IsExpanded="True" MinWidth="220" Margin="2,2,2,2">
                            <StackPanel>
                                <Border BorderThickness="1,1,1,1" CornerRadius="2,2,2,2" Panel.ZIndex="1" BorderBrush="Black" Padding="2,2,2,2">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Margin="4,0,4,0" VerticalAlignment="Center" Grid.Column="0">
                                    <Hyperlink x:Name="MaterialDiffuseMapHyperlink" Click="MaterialDiffuseMapHyperlink_Click" Style="{StaticResource TextureHyperlinkStyle}">
                                        No Diffuse Map
                                    </Hyperlink>
                                        </TextBlock>
                                        <Border BorderThickness="1,1,1,1" CornerRadius="1,1,1,1" Panel.ZIndex="1" BorderBrush="Black" Width="64" Height="64" Grid.Column="1">
                                            <Image x:Name="TextureDiffusePreviewImage" RenderOptions.EdgeMode="Aliased" RenderOptions.BitmapScalingMode="HighQuality" MaxWidth="64" MaxHeight="64" HorizontalAlignment="Center" VerticalAlignment="Center" Cursor="Hand" Tag="Diffuse" MouseLeftButtonUp="TexturePreview_MouseLeftButtonUp"/>
                                        </Border>
                                    </Grid>
                                </Border>

                                <Grid Margin="0,2,0,2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Diffuse Color Channel" FontWeight="Bold" Margin="4,2,4,2" HorizontalAlignment="Left" VerticalAlignment="Center" Grid.Column="0"/>

                                    <ComboBox x:Name="MaterialDiffuseColorChannelComboBox" SelectedIndex="0" Grid.Column="1" HorizontalAlignment="Right" MinWidth="50" Margin="4,0,4,0" Height="20" BorderThickness="1,1,1,1" BorderBrush="Black">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="{Binding Converter={StaticResource ChannelColorConverter}, ConverterParameter=Background}" BorderThickness="0">
                                                    <TextBlock Text="{Binding}" Foreground="{Binding Converter={StaticResource ChannelColorConverter}, ConverterParameter=Foreground}"/>
                                                </Border>
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                        <ComboBox.ItemContainerStyle>
                                            <Style TargetType="ComboBoxItem">
                                                <Setter Property="Background" Value="{Binding Converter={StaticResource ChannelColorConverter}, ConverterParameter=Background}"/>
                                                <Setter Property="Foreground" Value="{Binding Converter={StaticResource ChannelColorConverter}, ConverterParameter=Foreground}"/>
                                                <Setter Property="BorderThickness" Value="0"/>
                                            </Style>
                                        </ComboBox.ItemContainerStyle>
                                        <ComboBox.Style>
                                            <Style TargetType="ComboBox">
                                                <Setter Property="Background" Value="{Binding RelativeSource={RelativeSource Self}, Path=SelectedItem, Converter={StaticResource ChannelColorConverter}, ConverterParameter=Background}"/>
                                                <Setter Property="Foreground" Value="{Binding RelativeSource={RelativeSource Self}, Path=SelectedItem, Converter={StaticResource ChannelColorConverter}, ConverterParameter=Foreground}"/>
                                                <Setter Property="BorderThickness" Value="0"/>
                                            </Style>
                                        </ComboBox.Style>
                                    </ComboBox>

                                </Grid>

                                <Grid Margin="0,2,0,2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Diffuse UV Channel" FontWeight="Bold" Margin="4,2,4,2" HorizontalAlignment="Left" VerticalAlignment="Center" Grid.Column="0"/>
                                    <ComboBox x:Name="MaterialDiffuseUVChannelComboBox" SelectedIndex="0" Width="50" Margin="4,0,4,0" HorizontalAlignment="Right" VerticalAlignment="Center" Grid.Column="1" Height="20" BorderBrush="Black" Background="{x:Null}"/>
                                </Grid>

                                <Border BorderThickness="1,1,1,1" BorderBrush="Black" CornerRadius="2,2,2,2">
                                    <StackPanel Margin="4,2,4,2">
                                        <CheckBox x:Name="MaterialDiffuseTintCheckBox" Content="Diffuse Tint" Margin="4,2,4,2" HorizontalAlignment="Left" VerticalAlignment="Center" VerticalContentAlignment="Center" Padding="4,1,0,0" FlowDirection="RightToLeft"/>
                                        <Grid Margin="0,2,0,2">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="Diffuse Tint Color" Margin="4,2,4,2" HorizontalAlignment="Left" VerticalAlignment="Center" Grid.Column="0"/>
                                            <TextBox x:Name="MaterialTintColorRect" BorderBrush="Black" Width="64" Height="19" Margin="2,1,0,1" HorizontalAlignment="Right" VerticalAlignment="Center" Background="#FF678ADE" BorderThickness="1,1,1,1" Text="#ffffff00" Foreground="#E5000000" IsReadOnly="True" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Grid.Column="1"/>
                                            <xctk:ColorPicker x:Name="TintColorPicker" SelectedColorChanged="TintColorPicker_SelectedColorChanged" Width="20" Height="20" AvailableColorsSortingMode="HueSaturationBrightness" HorizontalContentAlignment="Left" VerticalContentAlignment="Center" RenderTransformOrigin="0.5,0.5" FontSize="10" VerticalAlignment="Top" ColorMode="ColorCanvas" BorderThickness="0,0,0,0" ShowRecentColors="True" Panel.ZIndex="1" Grid.Column="2" HorizontalAlignment="Right"/>
                                        </Grid>
                                        <CheckBox x:Name="MaterialDiffuseVertexColorCheckBox" Content="Diffuse Vertex Color" Margin="4,0,4,0" HorizontalAlignment="Left" VerticalAlignment="Center" VerticalContentAlignment="Center" Padding="4,1,0,0" FlowDirection="RightToLeft"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Expander>

                        <Expander x:Name="NormalExpander" Header="Normal Map" VerticalAlignment="Top" FontSize="10" VerticalContentAlignment="Top" FontWeight="Bold" Padding="2,2,4,4" BorderThickness="1,1,1,1" BorderBrush="Black" Background="#FF8E9AFF" IsExpanded="True" MinWidth="220" Margin="2,2,2,2">
                            <StackPanel>
                                <Border BorderThickness="1,1,1,1" CornerRadius="2,2,2,2" Panel.ZIndex="1" BorderBrush="Black" Padding="2,2,2,2">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Margin="4,0,4,0" VerticalAlignment="Center" Grid.Column="0">
                                    <Hyperlink x:Name="MaterialNormalMapHyperlink" Click="MaterialNormalMapHyperlink_Click" Style="{StaticResource TextureHyperlinkStyle}">
                                        No Normal Map
                                    </Hyperlink>
                                        </TextBlock>
                                        <Border BorderThickness="1,1,1,1" CornerRadius="1,1,1,1" Panel.ZIndex="1" BorderBrush="Black" Width="64" Height="64" Grid.Column="1">
                                            <Image x:Name="TextureNormalPreviewImage" RenderOptions.EdgeMode="Aliased" RenderOptions.BitmapScalingMode="HighQuality" MaxWidth="64" MaxHeight="64" HorizontalAlignment="Center" VerticalAlignment="Center" Cursor="Hand" Tag="Normal" MouseLeftButtonUp="TexturePreview_MouseLeftButtonUp"/>
                                        </Border>
                                    </Grid>
                                </Border>

                                <Grid Margin="0,2,0,2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Normal UV Channel" FontWeight="Bold" Margin="4,2,4,2" HorizontalAlignment="Left" VerticalAlignment="Center" Grid.Column="0"/>
                                    <ComboBox x:Name="MaterialNormalUVChannelComboBox" SelectedIndex="0" Width="50" Margin="4,0,4,0" HorizontalAlignment="Right" VerticalAlignment="Center" Grid.Column="1" BorderBrush="Black" Background="{x:Null}" Height="20"/>
                                </Grid>

                                <Grid Margin="0,2,0,2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Bumpiness" FontWeight="Bold" Margin="4,2,4,2" HorizontalAlignment="Left" VerticalAlignment="Center" Grid.Column="0"/>
                                    <TextBox x:Name="MaterialBumpinessTextBox" Width="50" Height="19" Margin="4,2,4,2" Background="White" BorderThickness="1,1,1,1" Text="0" Foreground="#E5000000" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Grid.Column="1" HorizontalAlignment="Right"/>
                                    <Slider x:Name="MaterialBumpinessIntensitySlider" Minimum="0" Maximum="1" Value="1" Width="143" SmallChange="0.01" VerticalAlignment="Center" Grid.Column="2" HorizontalAlignment="Right"/>
                                </Grid>

                            </StackPanel>
                        </Expander>

                        <Expander x:Name="SpecularExpander" Header="Specular" VerticalAlignment="Top" FontSize="10" VerticalContentAlignment="Top" FontWeight="Bold" Padding="2,2,4,4" BorderThickness="1,1,1,1" BorderBrush="Black" Background="#FFFFC68C" IsExpanded="True" MinWidth="220" Margin="2,2,2,2">
                            <StackPanel>
                                <Border BorderThickness="1,1,1,1" CornerRadius="2,2,2,2" Panel.ZIndex="1" BorderBrush="Black" Padding="2,2,2,2">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Margin="4,0,4,0" VerticalAlignment="Center" Grid.Column="0">
                                        <Hyperlink x:Name="MaterialSpecularMapHyperlink" Click="MaterialSpecularMapHyperlink_Click" Style="{StaticResource TextureHyperlinkStyle}">
                                            No Specular Map
                                        </Hyperlink>
                                        </TextBlock>
                                        <Border BorderThickness="1,1,1,1" CornerRadius="1,1,1,1" Panel.ZIndex="1" BorderBrush="Black" Width="64" Height="64" Grid.Column="1">
                                            <Image x:Name="TextureSpecularPreviewImage" RenderOptions.EdgeMode="Aliased" RenderOptions.BitmapScalingMode="HighQuality" MaxWidth="64" MaxHeight="64" HorizontalAlignment="Center" VerticalAlignment="Center" Cursor="Hand" Tag="Specular" MouseLeftButtonUp="TexturePreview_MouseLeftButtonUp"/>
                                        </Border>
                                    </Grid>
                                </Border>

                                <CheckBox x:Name="MaterialSpecularTintCheckBox" Content="Specular Tint" Margin="4,2,4,2" HorizontalAlignment="Left" VerticalAlignment="Center" VerticalContentAlignment="Center" Padding="4,1,0,0" FlowDirection="RightToLeft"/>

                                <Grid Margin="0,2,0,2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Specular Tint Color" Margin="4,2,4,2" HorizontalAlignment="Left" VerticalAlignment="Center" Grid.Column="0"/>
                                    <TextBox x:Name="MaterialSpecularTintColorRect" BorderBrush="Black" Width="64" Height="19" Margin="2,1,0,1" HorizontalAlignment="Right" VerticalAlignment="Center" Background="#FF678ADE" BorderThickness="1,1,1,1" Text="#ffffff00" Foreground="#E5000000" IsReadOnly="True" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Grid.Column="1"/>
                                    <xctk:ColorPicker x:Name="TintSpecularColorPicker" SelectedColorChanged="TintSpecularColorPicker_SelectedColorChanged" Width="20" Height="20" AvailableColorsSortingMode="HueSaturationBrightness" HorizontalContentAlignment="Left" VerticalContentAlignment="Center" RenderTransformOrigin="0.5,0.5" FontSize="10" HorizontalAlignment="Left" VerticalAlignment="Top" ColorMode="ColorCanvas" BorderThickness="0,0,0,0" ShowRecentColors="True" Panel.ZIndex="1" Grid.Column="2"/>
                                </Grid>

                                <Grid Margin="0,2,0,2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Specular Color Channel" FontWeight="Bold" Margin="4,2,4,2" HorizontalAlignment="Left" VerticalAlignment="Center" Grid.Column="0"/>

                                    <ComboBox x:Name="MaterialSpecularColorChannelComboBox" SelectedIndex="0" Grid.Column="1" HorizontalAlignment="Right" MinWidth="50" Margin="4,0,4,0" BorderThickness="1,1,1,1" Height="20" BorderBrush="Black">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="{Binding Converter={StaticResource ChannelColorConverter}, ConverterParameter=Background}" BorderThickness="0">
                                                    <TextBlock Text="{Binding}" Foreground="{Binding Converter={StaticResource ChannelColorConverter}, ConverterParameter=Foreground}"/>
                                                </Border>
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                        <ComboBox.ItemContainerStyle>
                                            <Style TargetType="ComboBoxItem">
                                                <Setter Property="Background" Value="{Binding Converter={StaticResource ChannelColorConverter}, ConverterParameter=Background}"/>
                                                <Setter Property="Foreground" Value="{Binding Converter={StaticResource ChannelColorConverter}, ConverterParameter=Foreground}"/>
                                                <Setter Property="BorderThickness" Value="0"/>
                                            </Style>
                                        </ComboBox.ItemContainerStyle>
                                        <ComboBox.Style>
                                            <Style TargetType="ComboBox">
                                                <Setter Property="Background" Value="{Binding RelativeSource={RelativeSource Self}, Path=SelectedItem, Converter={StaticResource ChannelColorConverter}, ConverterParameter=Background}"/>
                                                <Setter Property="Foreground" Value="{Binding RelativeSource={RelativeSource Self}, Path=SelectedItem, Converter={StaticResource ChannelColorConverter}, ConverterParameter=Foreground}"/>
                                                <Setter Property="BorderThickness" Value="0"/>
                                            </Style>
                                        </ComboBox.Style>
                                    </ComboBox>

                                </Grid>

                                <Border BorderThickness="1,1,1,1" CornerRadius="2,2,2,2" Panel.ZIndex="1" BorderBrush="Black" Padding="2,2,2,2" Margin="0,2,0,2">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Margin="4,0,4,0" VerticalAlignment="Center" Grid.Column="0">
                                    <Hyperlink x:Name="MaterialMetalnessMapHyperlink" Click="MaterialMetalnessMapHyperlink_Click" Style="{StaticResource TextureHyperlinkStyle}">
                                        No Metalness Map
                                    </Hyperlink>
                                        </TextBlock>
                                        <Border BorderThickness="1,1,1,1" CornerRadius="1,1,1,1" Panel.ZIndex="1" BorderBrush="Black" Width="64" Height="64" Grid.Column="1">
                                            <Image x:Name="TextureMetalnessPreviewImage" RenderOptions.EdgeMode="Aliased" RenderOptions.BitmapScalingMode="HighQuality" MaxWidth="64" MaxHeight="64" HorizontalAlignment="Center" VerticalAlignment="Center" Cursor="Hand" Tag="Metalness" MouseLeftButtonUp="TexturePreview_MouseLeftButtonUp"/>
                                        </Border>
                                    </Grid>
                                </Border>

                                <Border BorderThickness="1,1,1,1" BorderBrush="Black" CornerRadius="2,2,2,2" Padding="2,2,2,2">
                                    <StackPanel VerticalAlignment="Top">

                                        <GroupBox BorderBrush="Black" HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch" Header="Metalness">
                                            <StackPanel AutomationProperties.Name="Metalness">
                                                <CheckBox x:Name="MaterialUseMetalnessCheckBox" Content="Use Metalness" Margin="4,2,4,2" VerticalAlignment="Center" VerticalContentAlignment="Center" Padding="4,1,0,0" HorizontalAlignment="Left" HorizontalContentAlignment="Stretch" FlowDirection="RightToLeft" Grid.IsSharedSizeScope="True"/>

                                                <CheckBox x:Name="MaterialSpecularVertexColorCheckBox" Content="Metalness Vertex Color" Margin="4,2,4,2" HorizontalAlignment="Left" VerticalAlignment="Center" VerticalContentAlignment="Center" Padding="4,1,0,0" FlowDirection="RightToLeft"/>

                                                <Grid Margin="0,2,0,2">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Text="Metalness Color Channel" FontWeight="Bold" Margin="4,2,4,2" HorizontalAlignment="Left" VerticalAlignment="Center" Grid.Column="0"/>

                                                    <ComboBox x:Name="MaterialMetalnessColorChannelComboBox" SelectedIndex="0" Grid.Column="1" HorizontalAlignment="Right" MinWidth="50" Margin="4,0,4,0" Height="20" BorderThickness="1,1,1,1" BorderBrush="Black">
                                                        <ComboBox.ItemTemplate>
                                                            <DataTemplate>
                                                                <Border Background="{Binding Converter={StaticResource ChannelColorConverter}, ConverterParameter=Background}" BorderThickness="0">
                                                                    <TextBlock Text="{Binding}" Foreground="{Binding Converter={StaticResource ChannelColorConverter}, ConverterParameter=Foreground}"/>
                                                                </Border>
                                                            </DataTemplate>
                                                        </ComboBox.ItemTemplate>
                                                        <ComboBox.ItemContainerStyle>
                                                            <Style TargetType="ComboBoxItem">
                                                                <Setter Property="Background" Value="{Binding Converter={StaticResource ChannelColorConverter}, ConverterParameter=Background}"/>
                                                                <Setter Property="Foreground" Value="{Binding Converter={StaticResource ChannelColorConverter}, ConverterParameter=Foreground}"/>
                                                                <Setter Property="BorderThickness" Value="0"/>
                                                            </Style>
                                                        </ComboBox.ItemContainerStyle>
                                                        <ComboBox.Style>
                                                            <Style TargetType="ComboBox">
                                                                <Setter Property="Background" Value="{Binding RelativeSource={RelativeSource Self}, Path=SelectedItem, Converter={StaticResource ChannelColorConverter}, ConverterParameter=Background}"/>
                                                                <Setter Property="Foreground" Value="{Binding RelativeSource={RelativeSource Self}, Path=SelectedItem, Converter={StaticResource ChannelColorConverter}, ConverterParameter=Foreground}"/>
                                                                <Setter Property="BorderThickness" Value="0"/>
                                                            </Style>
                                                        </ComboBox.Style>
                                                    </ComboBox>

                                                </Grid>


                                                <Grid Margin="0,2,0,2">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Text="Metalness" FontWeight="Bold" Margin="4,2,4,2" HorizontalAlignment="Left" VerticalAlignment="Center" Grid.Column="0"/>
                                                    <TextBox x:Name="MaterialMetalnessTextBox" Width="50" Height="19" Margin="4,2,4,2" HorizontalAlignment="Left" VerticalAlignment="Center" Background="White" BorderThickness="1,1,1,1" Text="0" Foreground="#E5000000" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Grid.Column="1"/>
                                                    <Slider x:Name="MaterialMetalnessIntensitySlider" Minimum="0" Maximum="1" Value="1" Width="115" SmallChange="0.01" VerticalContentAlignment="Center" HorizontalContentAlignment="Center" VerticalAlignment="Center" Grid.Column="1" HorizontalAlignment="Right" Margin="59,0,0,0"/>
                                                </Grid>

                                                <Grid Margin="0,2,0,2">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Text="Metalness UV Channel" FontWeight="Bold" Margin="4,2,4,2" HorizontalAlignment="Left" VerticalAlignment="Center" Grid.Column="0"/>
                                                    <ComboBox x:Name="MaterialSpecularUVChannelComboBox" SelectedIndex="0" Width="50" Margin="4,0,4,0" HorizontalAlignment="Right" VerticalAlignment="Center" Grid.Column="1" Height="20" BorderBrush="Black" Background="{x:Null}"/>
                                                </Grid>
                                            </StackPanel>
                                        </GroupBox>

                                        <Border BorderThickness="1,1,1,1" CornerRadius="2,2,2,2" Panel.ZIndex="1" BorderBrush="Black" Padding="2,2,2,2">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Margin="4,0,4,0" VerticalAlignment="Center" Grid.Column="0">
                                            <Hyperlink x:Name="MaterialGlossMapHyperlink" Click="MaterialGlossMapHyperlink_Click" Style="{StaticResource TextureHyperlinkStyle}">
                                                No Gloss Map
                                            </Hyperlink>
                                                </TextBlock>
                                                <Border BorderThickness="1,1,1,1" CornerRadius="1,1,1,1" Panel.ZIndex="1" BorderBrush="Black" Width="64" Height="64" Grid.Column="1">
                                            <Image x:Name="TextureGlossPreviewImage" RenderOptions.EdgeMode="Aliased" RenderOptions.BitmapScalingMode="HighQuality" MaxWidth="64" MaxHeight="64" HorizontalAlignment="Center" VerticalAlignment="Center" Cursor="Hand" Tag="Gloss" MouseLeftButtonUp="TexturePreview_MouseLeftButtonUp"/>
                                                </Border>
                                            </Grid>
                                        </Border>

                                        <Grid Margin="0,2,0,2">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="Glossiness" FontWeight="Bold" Margin="4,2,4,2" HorizontalAlignment="Left" VerticalAlignment="Center" Grid.Column="0"/>
                                            <TextBox x:Name="MaterialGlossinessTextBox" Width="50" Height="19" Margin="4,2,4,2" HorizontalAlignment="Left" VerticalAlignment="Center" Background="White" BorderThickness="1,1,1,1" Text="0" Foreground="#E5000000" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Grid.Column="1"/>
                                            <Slider x:Name="MaterialGlossinessIntensitySlider" Minimum="0" Maximum="100" Value="1" Width="135" SmallChange="0.01" VerticalContentAlignment="Center" HorizontalContentAlignment="Center" HorizontalAlignment="Right" VerticalAlignment="Center" Grid.Column="1" Grid.ColumnSpan="2"/>
                                        </Grid>


                                        <Grid Margin="0,2,0,2">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="Glossiness Color Channel" FontWeight="Bold" Margin="4,2,4,2" HorizontalAlignment="Left" VerticalAlignment="Center" Grid.Column="0"/>

                                            <ComboBox x:Name="MaterialGlossinessColorChannelComboBox" SelectedIndex="0" Grid.Column="1" HorizontalAlignment="Right" MinWidth="50" Margin="4,0,4,0" Height="20" BorderThickness="1,1,1,1">
                                                <ComboBox.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Background="{Binding Converter={StaticResource ChannelColorConverter}, ConverterParameter=Background}" BorderThickness="0">
                                                            <TextBlock Text="{Binding}" Foreground="{Binding Converter={StaticResource ChannelColorConverter}, ConverterParameter=Foreground}"/>
                                                        </Border>
                                                    </DataTemplate>
                                                </ComboBox.ItemTemplate>
                                                <ComboBox.ItemContainerStyle>
                                                    <Style TargetType="ComboBoxItem">
                                                        <Setter Property="Background" Value="{Binding Converter={StaticResource ChannelColorConverter}, ConverterParameter=Background}"/>
                                                        <Setter Property="Foreground" Value="{Binding Converter={StaticResource ChannelColorConverter}, ConverterParameter=Foreground}"/>
                                                        <Setter Property="BorderThickness" Value="0"/>
                                                    </Style>
                                                </ComboBox.ItemContainerStyle>
                                                <ComboBox.Style>
                                                    <Style TargetType="ComboBox">
                                                        <Setter Property="Background" Value="{Binding RelativeSource={RelativeSource Self}, Path=SelectedItem, Converter={StaticResource ChannelColorConverter}, ConverterParameter=Background}"/>
                                                        <Setter Property="Foreground" Value="{Binding RelativeSource={RelativeSource Self}, Path=SelectedItem, Converter={StaticResource ChannelColorConverter}, ConverterParameter=Foreground}"/>
                                                        <Setter Property="BorderThickness" Value="0"/>
                                                    </Style>
                                                </ComboBox.Style>
                                            </ComboBox>

                                        </Grid>


                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Expander>

                        <!-- Другие параметры -->
                        <Expander x:Name="OtherExpander" Header="Other" VerticalAlignment="Top" FontSize="10" VerticalContentAlignment="Top" FontWeight="Bold" IsExpanded="True" Padding="2,2,4,4" BorderThickness="1,1,1,1" BorderBrush="Black" Background="#FF9DC4E8" MinWidth="220" Margin="2,2,2,2">
                            <StackPanel>
                                <TextBlock x:Name="MaterialCreatedAtTextBlock" Text="Data: " Margin="4,0,4,0" FontWeight="Normal" />
                                <TextBlock x:Name="MaterialShaderTextBlock" Text="Shader: " Margin="4,0,4,0" FontWeight="Normal" />
                                <TextBlock x:Name="MaterialBlendTypeTextBlock" Text="BlendType: " Margin="4,0,4,0" FontWeight="Normal" />
                                <TextBlock x:Name="MaterialCullTextBlock" Text="Cull: " Margin="4,0,4,0" FontWeight="Normal" />
                                <TextBlock x:Name="MaterialUseLightingTextBlock" Text="UseLighting: " Margin="4,0,4,0" FontWeight="Normal" />
                                <TextBlock x:Name="MaterialTwoSidedLightingTextBlock" Text="TwoSidedLighting: " Margin="4,0,4,0" FontWeight="Normal" />
                                <TextBlock x:Name="MaterialReflectivityTextBlock" Text="Reflectivity: " Margin="4,0,4,0" FontWeight="Normal" />
                                <TextBlock x:Name="MaterialAlphaTestTextBlock" Text="AlphaTest: " Margin="4,0,4,0" FontWeight="Normal" />
                            </StackPanel>
                        </Expander>
                    </StackPanel>
                    </ScrollViewer>
                </Border>
            </ScrollViewer>

        </Grid>
    </DockPanel>
</Window>
