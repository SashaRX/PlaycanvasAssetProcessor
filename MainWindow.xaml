<Window
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
    xmlns:local="clr-namespace:AssetProcessor"
    xmlns:settings="clr-namespace:AssetProcessor.Settings"
    xmlns:controls="clr-namespace:AssetProcessor.Controls"
    xmlns:help ="clr-namespace:AssetProcessor.Helpers"
    xmlns:viewer="clr-namespace:AssetProcessor.TextureViewer"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:av="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:helix="http://helix-toolkit.org/wpf"
    xmlns:oxy="http://oxyplot.org/wpf"
    xmlns:avalonedit="http://icsharpcode.net/sharpdevelop/avalonedit"
    xmlns:resources="clr-namespace:AssetProcessor.Resources"
    xmlns:viewModels="clr-namespace:AssetProcessor.ViewModels"
    xmlns:infra="clr-namespace:AssetProcessor.Infrastructure"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    av:DataContext="{av:DesignInstance Type=viewModels:MainViewModel}"
    DataContext="{Binding ViewModel, RelativeSource={RelativeSource Self}}"
    mc:Ignorable="av"
    x:Class="AssetProcessor.MainWindow"
    Title="MainWindow" Height="684" Width="942"
    Background="{DynamicResource ThemeBackground}"
    KeyDown="Window_KeyDown"
    StateChanged="Window_StateChanged">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <help:SizeConverter x:Key="SizeConverter" />
        <help:ResolutionConverter x:Key="ResolutionConverter" />
        <help:StatusToVisibilityConverter x:Key="StatusToVisibilityConverter" />
        <help:StatusToVisibilityInverseConverter x:Key="StatusToVisibilityInverseConverter" />
        <help:StatusToForegroundConverter x:Key="StatusToForegroundConverter" />
        <help:TextureTypeToBackgroundConverter x:Key="TextureTypeToBackgroundConverter" />
        <help:ORMTextureColorConverter x:Key="ORMTextureColorConverter" />
        <help:InverseBoolConverter x:Key="InverseBoolConverter" />
        <help:EnumToVisibilityConverter x:Key="EnumToVisibilityConverter" />
        <help:SafeFirstItemPropertyConverter x:Key="SafeFirstItemPropertyConverter" />
        <help:CollectionHasItemsToVisibilityConverter x:Key="CollectionHasItemsToVisibilityConverter" />

        <!-- Right panel expanders style (larger font than panel compact style) -->
        <Style x:Key="RightPanelExpanderStyle" TargetType="Expander" BasedOn="{StaticResource CompactExpanderStyle}">
            <Setter Property="FontSize" Value="11"/>
        </Style>

        <!-- CheckBox style for dark backgrounds (Model/Texture info panels) -->
        <Style x:Key="DarkBackgroundCheckBoxStyle" TargetType="CheckBox">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="9"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="CheckBox">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Border x:Name="CheckBorder"
                                    Width="12" Height="12"
                                    BorderBrush="#FFAAAAAA"
                                    BorderThickness="1"
                                    Background="#33FFFFFF"
                                    CornerRadius="2"
                                    Margin="0,0,4,0">
                                <Path x:Name="CheckMark"
                                      Visibility="Collapsed"
                                      Stroke="White"
                                      StrokeThickness="2"
                                      Data="M 2,6 L 5,9 L 10,2"/>
                            </Border>
                            <ContentPresenter VerticalAlignment="Center"/>
                        </StackPanel>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="CheckMark" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="CheckBorder" Property="Background" Value="#FF4CAF50"/>
                                <Setter TargetName="CheckBorder" Property="BorderBrush" Value="#FF4CAF50"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="CheckBorder" Property="BorderBrush" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <help:ChannelColorConverter x:Key="ChannelColorConverter" />

        <!-- OxyPlot tracker (tooltip) template with theme-aware colors -->
        <ControlTemplate x:Key="HistogramTrackerTemplate">
            <oxy:TrackerControl Position="{Binding Position}"
                                Background="{DynamicResource ThemeTrackerBackground}"
                                BorderBrush="{DynamicResource ThemeTrackerBorder}"
                                BorderThickness="1"
                                LineExtents="{Binding PlotModel.PlotArea}">
                <oxy:TrackerControl.Content>
                    <TextBlock Text="{Binding}"
                               Foreground="{DynamicResource ThemeTrackerForeground}"
                               Margin="6,4"/>
                </oxy:TrackerControl.Content>
            </oxy:TrackerControl>
        </ControlTemplate>

        <!-- Стиль для кликабельных гиперссылок текстур в материалах -->
        <Style x:Key="TextureHyperlinkStyle" TargetType="Hyperlink">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="{DynamicResource ThemeHyperlink}"/>
            <Setter Property="TextDecorations" Value="Underline"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Foreground" Value="#FFFFA500"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- ContextMenu для заголовков колонок текстур -->
        <ContextMenu x:Key="TextureColumnHeaderContextMenu">
            <MenuItem Header="Columns Visibility">
                <MenuItem Header="Export" IsCheckable="True" IsChecked="True" Click="TextureColumnVisibility_Click" Tag="Export"/>
                <MenuItem Header="№" IsCheckable="True" IsChecked="True" Click="TextureColumnVisibility_Click" Tag="Index"/>
                <MenuItem Header="ID" IsCheckable="True" IsChecked="True" Click="TextureColumnVisibility_Click" Tag="ID"/>
                <MenuItem Header="Texture Name" IsCheckable="True" IsChecked="True" Click="TextureColumnVisibility_Click" Tag="TextureName"/>
                <MenuItem Header="Extension" IsCheckable="True" IsChecked="True" Click="TextureColumnVisibility_Click" Tag="Extension"/>
                <MenuItem Header="Size" IsCheckable="True" IsChecked="True" Click="TextureColumnVisibility_Click" Tag="Size"/>
                <MenuItem Header="Compressed" IsCheckable="True" IsChecked="True" Click="TextureColumnVisibility_Click" Tag="Compressed"/>
                <MenuItem Header="Resolution" IsCheckable="True" IsChecked="True" Click="TextureColumnVisibility_Click" Tag="Resolution"/>
                <MenuItem Header="Resize" IsCheckable="True" IsChecked="True" Click="TextureColumnVisibility_Click" Tag="ResizeResolution"/>
                <MenuItem Header="Format" IsCheckable="True" IsChecked="True" Click="TextureColumnVisibility_Click" Tag="Compression"/>
                <MenuItem Header="Mipmaps" IsCheckable="True" IsChecked="True" Click="TextureColumnVisibility_Click" Tag="Mipmaps"/>
                <MenuItem Header="Preset" IsCheckable="True" IsChecked="True" Click="TextureColumnVisibility_Click" Tag="Preset"/>
                <MenuItem Header="Status" IsCheckable="True" IsChecked="True" Click="TextureColumnVisibility_Click" Tag="Status"/>
            </MenuItem>
        </ContextMenu>

        <!-- ContextMenu для строк текстур -->
        <ContextMenu x:Key="TextureRowContextMenu">
            <MenuItem Header="Process Texture" Click="ProcessSelectedTextures_Click"/>
            <MenuItem Header="Upload to PlayCanvas" Click="UploadTexture_Click"/>
            <Separator/>
            <MenuItem Header="Delete ORM Texture" Click="DeleteORMFromList_Click"/>
            <Separator/>
            <MenuItem Header="Open Source Folder" Click="OpenFileLocation_Click"/>
            <MenuItem Header="Open Processed Folder" Click="OpenProcessedFolder_Click"/>
            <MenuItem Header="Copy Path" Click="CopyTexturePath_Click"/>
            <Separator/>
            <MenuItem Header="Refresh Preview" Click="RefreshPreview_Click"/>
        </ContextMenu>

        <!-- ContextMenu для строк моделей -->
        <ContextMenu x:Key="ModelRowContextMenu">
            <MenuItem Header="Process Model" Click="ProcessSelectedModel_Click"/>
            <Separator/>
            <MenuItem Header="Open Source Folder" Click="OpenModelFileLocation_Click"/>
            <MenuItem Header="Open Processed Folder" Click="OpenModelProcessedFolder_Click"/>
            <MenuItem Header="Copy Path" Click="CopyModelPath_Click"/>
            <Separator/>
            <MenuItem Header="Refresh Preview" Click="RefreshModelPreview_Click"/>
        </ContextMenu>

        <!-- ContextMenu для заголовков колонок моделей -->
        <ContextMenu x:Key="ModelColumnHeaderContextMenu">
            <MenuItem Header="Columns Visibility">
                <MenuItem Header="Export" IsCheckable="True" IsChecked="True" Click="ModelColumnVisibility_Click" Tag="Export"/>
                <MenuItem Header="№" IsCheckable="True" IsChecked="True" Click="ModelColumnVisibility_Click" Tag="Index"/>
                <MenuItem Header="ID" IsCheckable="True" IsChecked="True" Click="ModelColumnVisibility_Click" Tag="ID"/>
                <MenuItem Header="Model Name" IsCheckable="True" IsChecked="True" Click="ModelColumnVisibility_Click" Tag="Name"/>
                <MenuItem Header="Size" IsCheckable="True" IsChecked="True" Click="ModelColumnVisibility_Click" Tag="Size"/>
                <MenuItem Header="UV Channels" IsCheckable="True" IsChecked="True" Click="ModelColumnVisibility_Click" Tag="UVChannels"/>
                <MenuItem Header="Extension" IsCheckable="True" IsChecked="True" Click="ModelColumnVisibility_Click" Tag="Extension"/>
                <MenuItem Header="Status" IsCheckable="True" IsChecked="True" Click="ModelColumnVisibility_Click" Tag="Status"/>
            </MenuItem>
        </ContextMenu>

        <!-- ContextMenu для строк материалов -->
        <ContextMenu x:Key="MaterialRowContextMenu" Opened="MaterialRowContextMenu_Opened">
            <MenuItem Header="Set Master Material" FontWeight="Bold">
                <MenuItem Header="(None)" Click="SetMasterForSelectedMaterials_Click" Tag=""/>
            </MenuItem>
            <Separator/>
            <MenuItem Header="Create ORM Texture" Click="CreateORMFromMaterial_Click"/>
            <MenuItem Header="Create ORM for All Materials" Click="CreateORMForAllMaterials_Click"/>
            <Separator/>
            <MenuItem Header="Delete ORM Texture" Click="DeleteORMTexture_Click"/>
            <Separator/>
            <MenuItem Header="Open Source Folder" Click="OpenMaterialSourceFolder_Click"/>
            <MenuItem Header="Open Processed Folder" Click="OpenMaterialProcessedFolder_Click"/>
        </ContextMenu>

        <!-- ContextMenu для заголовков колонок материалов -->
        <ContextMenu x:Key="MaterialColumnHeaderContextMenu">
            <MenuItem Header="Columns Visibility">
                <MenuItem Header="Export" IsCheckable="True" IsChecked="True" Click="MaterialColumnVisibility_Click" Tag="Export"/>
                <MenuItem Header="№" IsCheckable="True" IsChecked="True" Click="MaterialColumnVisibility_Click" Tag="Index"/>
                <MenuItem Header="ID" IsCheckable="True" IsChecked="True" Click="MaterialColumnVisibility_Click" Tag="ID"/>
                <MenuItem Header="Name" IsCheckable="True" IsChecked="True" Click="MaterialColumnVisibility_Click" Tag="Name"/>
                <MenuItem Header="Master" IsCheckable="True" IsChecked="True" Click="MaterialColumnVisibility_Click" Tag="Master"/>
                <MenuItem Header="Status" IsCheckable="True" IsChecked="True" Click="MaterialColumnVisibility_Click" Tag="Status"/>
            </MenuItem>
        </ContextMenu>

        <!-- ContextMenu для строк Master Materials -->
        <ContextMenu x:Key="MasterMaterialRowContextMenu">
            <MenuItem Header="Clone" Click="MasterMaterial_Clone_Click" FontWeight="Bold"/>
            <MenuItem Header="Edit" Click="MasterMaterial_Edit_Click"/>
            <Separator/>
            <MenuItem Header="Delete" Click="MasterMaterial_Delete_Click"/>
        </ContextMenu>

        <!-- ContextMenu для строк Chunks -->
        <ContextMenu x:Key="ChunkRowContextMenu">
            <MenuItem Header="Edit" Click="Chunk_Edit_Click"/>
            <MenuItem Header="Copy" Click="Chunk_Copy_Click" FontWeight="Bold"/>
            <Separator/>
            <MenuItem Header="Delete" Click="Chunk_Delete_Click"/>
        </ContextMenu>

        <!-- ContextMenu для ORM групп (подгрупп текстур) - временно отключено до реализации -->
        <ContextMenu x:Key="ORMGroupContextMenu">
            <MenuItem Header="ORM Group Actions (Coming Soon)" IsEnabled="False"/>
        </ContextMenu>

    </Window.Resources>
    <DockPanel>
        <!-- Статусная строка -->
        <StatusBar DockPanel.Dock="Bottom">
            <StatusBarItem>
                <TextBlock Text="{Binding ConnectionStatusText}"
                           VerticalAlignment="Center"
                           Width="320">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground" Value="Red"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsConnected}" Value="True">
                                    <Setter Property="Foreground" Value="Green"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock Text="{Binding VersionText}" VerticalAlignment="Center" Foreground="{DynamicResource ThemeForegroundDim}" FontSize="10" MinWidth="200" TextAlignment="Right"/>
            </StatusBarItem>
        </StatusBar>

        <!-- Прогресс -->
        <Grid DockPanel.Dock="Bottom" HorizontalAlignment="Stretch">
            <ProgressBar
                         Height="16"
                         HorizontalAlignment="Stretch"
                         VerticalAlignment="Center"
                         Minimum="0"
                         Maximum="{Binding ProgressMaximum}"
                         Value="{Binding ProgressValue}"/>
            <TextBlock HorizontalAlignment="Center"
                       VerticalAlignment="Center"
                       Foreground="{DynamicResource ThemeForeground}"
                       FontWeight="Bold"
                       Text="{Binding ProgressText}"/>
            <!-- Loading status overlay -->
            <TextBlock HorizontalAlignment="Left"
                       VerticalAlignment="Center"
                       Margin="8,0,0,0"
                       Foreground="{DynamicResource ThemeForeground}"
                       FontWeight="SemiBold"
                       Text="{Binding AssetLoading.LoadingStatus}"
                       Visibility="{Binding AssetLoading.IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"/>
        </Grid>

        <!-- Панель управления внизу -->
        <Grid DockPanel.Dock="Bottom" Margin="4,4,4,6" Height="85">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="420"/>
                <ColumnDefinition Width="*" MinWidth="120"/>
            </Grid.ColumnDefinitions>

            <!-- Playcanvas Project Connect (Left Side) -->
            <controls:ConnectionPanel Grid.Column="0" x:Name="connectionPanel"/>

            <!-- Unified Export Panel - Always visible -->
            <controls:ExportToolsPanel Grid.Column="1" x:Name="exportToolsPanel"/>

            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Right" Margin="2,0,2,0">
                <Button Content="Settings" VerticalAlignment="Center" Background="{DynamicResource ThemeBackgroundAlt}" Click="Setting" Padding="6,4"/>
                <Button Content="Cancel" Click="CancelButton_Click" IsEnabled="{Binding IsCancelEnabled}" Padding="6,4" Margin="4,0,0,0"/>
            </StackPanel>
        </Grid>

        <Grid DockPanel.Dock="Top" VerticalAlignment="Top">
            <Menu VerticalAlignment="Top" Margin="0,0,2,0">
                <MenuItem Header="File">
                    <MenuItem Header="Settings" Click="SettingsMenu"/>
                    <MenuItem Header="Exit" Click="ExitMenu"/>
                </MenuItem>
                <MenuItem Header="View">
                    <MenuItem Header="Theme">
                        <MenuItem Header="Auto (System)" IsCheckable="True" IsChecked="{Binding IsThemeAuto}" Click="ThemeAuto_Click"/>
                        <MenuItem Header="Light" IsCheckable="True" IsChecked="{Binding IsThemeLight}" Click="ThemeLight_Click"/>
                        <MenuItem Header="Dark" IsCheckable="True" IsChecked="{Binding IsThemeDark}" Click="ThemeDark_Click"/>
                    </MenuItem>
                </MenuItem>
                <MenuItem Header="Help">
                    <MenuItem Header="About" Click="AboutMenu"/>
                </MenuItem>
            </Menu>
        </Grid>

        <!-- Основной контент -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition x:Name="PreviewColumn" Width="300" MinWidth="256" MaxWidth="512" />
            </Grid.ColumnDefinitions>

            <TabControl x:Name="tabControl" Grid.Column="0" Padding="1,1,1,1" BorderThickness="0,0,0,0" SelectionChanged="TabControl_SelectionChanged">
                <TabItem x:Name="TexturesTabItem" Header="Textures" Height="22" Margin="-2,-2,-2,0" VerticalAlignment="Top">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="4,2,4,2">
                            <TextBlock Text="Scale:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <Slider Width="120" Minimum="0.5" Maximum="2.0"
                                    Value="{Binding Source={x:Static settings:AppSettings.Default}, Path=TexturesTableScale, Mode=TwoWay}"
                                    TickFrequency="0.1" IsSnapToTickEnabled="True" VerticalAlignment="Center"
                                    ToolTip="Adjust table scale (50% - 200%)"
                                    ValueChanged="TableScaleSlider_ValueChanged"/>
                            <TextBlock Text="{Binding Source={x:Static settings:AppSettings.Default}, Path=TexturesTableScale, StringFormat={}{0:P0}}"
                                       VerticalAlignment="Center" Margin="5,0,15,0" MinWidth="40"/>
                            <CheckBox Content="Group by Type" Margin="0,0,15,0" VerticalAlignment="Center"
                                        IsChecked="{Binding Source={x:Static settings:AppSettings.Default}, Path=GroupTexturesByType, Mode=TwoWay}"
                                        Checked="GroupTexturesCheckBox_Changed" Unchecked="GroupTexturesCheckBox_Changed"/>
                            <CheckBox Content="Collapse Groups" Margin="0,0,15,0" VerticalAlignment="Center"
                                        IsChecked="{Binding Source={x:Static settings:AppSettings.Default}, Path=CollapseTextureGroups, Mode=TwoWay}"
                                        Checked="CollapseGroupsCheckBox_Changed" Unchecked="CollapseGroupsCheckBox_Changed"/>
                            <CheckBox Content="Dark Theme" VerticalAlignment="Center" IsChecked="{Binding IsDarkThemeChecked}" Click="DarkThemeCheckBox_Click"/>
                        </StackPanel>
                        <DataGrid x:Name="TexturesDataGrid" Grid.Row="1"
                                AutoGenerateColumns="False"
                                ItemsSource="{Binding Textures}"
                                SelectedItem="{Binding SelectedTexture, Mode=TwoWay}"
                                HeadersVisibility="Column"
                                UseLayoutRounding="True"
                                SnapsToDevicePixels="True"
                                SelectionChanged="TexturesDataGrid_SelectionChanged"
                                LoadingRow="TexturesDataGrid_LoadingRow"
                                Sorting="TexturesDataGrid_Sorting"
                                SizeChanged="TexturesDataGrid_SizeChanged"
                                ColumnDisplayIndexChanged="TexturesDataGrid_ColumnDisplayIndexChanged"
                                IsReadOnly="False"
                                CanUserAddRows="False"
                                CanUserDeleteRows="False"
                                CanUserSortColumns="True"
                                CanUserResizeColumns="True"
                                CanUserReorderColumns="True"
                                Background="{DynamicResource ThemeDataGridBackground}"
                                RowHeight="16"
                                VirtualizingPanel.IsVirtualizing="True"
                                VirtualizingPanel.IsVirtualizingWhenGrouping="True"
                                VirtualizingPanel.VirtualizationMode="Standard"
                                VirtualizingPanel.ScrollUnit="Pixel"
                                VirtualizingPanel.CacheLength="1,1"
                                VirtualizingPanel.CacheLengthUnit="Page"
                                EnableRowVirtualization="True"
                                EnableColumnVirtualization="True"
                                ScrollViewer.CanContentScroll="True"
                                ScrollViewer.IsDeferredScrollingEnabled="True"
                                HorizontalScrollBarVisibility="Disabled">
                            <DataGrid.LayoutTransform>
                                <ScaleTransform ScaleX="{Binding Source={x:Static settings:AppSettings.Default}, Path=TexturesTableScale}"
                                                ScaleY="{Binding Source={x:Static settings:AppSettings.Default}, Path=TexturesTableScale}"/>
                            </DataGrid.LayoutTransform>
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource {x:Type DataGridColumnHeader}}">
                                    <Setter Property="ContextMenu" Value="{StaticResource TextureColumnHeaderContextMenu}"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                            <DataGrid.RowStyle>
                                <Style TargetType="DataGridRow">
                                    <Setter Property="ContextMenu" Value="{StaticResource TextureRowContextMenu}"/>
                                    <!-- RowBackground computed in ViewModel for texture type coloring -->
                                    <Setter Property="Background" Value="{Binding RowBackground}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource ThemeForeground}"/>
                                    <Style.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background" Value="{DynamicResource ThemeAccent}"/>
                                            <Setter Property="Foreground" Value="{DynamicResource ThemeAccentForeground}"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.RowStyle>
                            <DataGrid.CellStyle>
                                <Style TargetType="DataGridCell" BasedOn="{StaticResource {x:Type DataGridCell}}">
                                    <Setter Property="BorderBrush" Value="Transparent"/>
                                </Style>
                            </DataGrid.CellStyle>
                            <DataGrid.Columns>
                                <DataGridCheckBoxColumn Header="Export" Binding="{Binding ExportToServer, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="50" MinWidth="40"
                                                        ElementStyle="{StaticResource DataGridCheckBoxStyle}"
                                                        EditingElementStyle="{StaticResource DataGridCheckBoxStyle}"/>
                                <DataGridTextColumn Header="№" Binding="{Binding Index}" IsReadOnly="True" Width="35" MinWidth="30" />
                                <DataGridTextColumn Header="ID" Binding="{Binding ID}" IsReadOnly="True" Width="60" MinWidth="40" />
                                <DataGridTextColumn Header="Texture Name" Binding="{Binding Name}" IsReadOnly="True" Width="2*" MinWidth="60">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                            <Setter Property="ToolTip" Value="{Binding Name}"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Extension" Binding="{Binding Extension}" IsReadOnly="True" Width="65" MinWidth="35"/>
                                <DataGridTextColumn Header="Size" Binding="{Binding Size, Converter={StaticResource SizeConverter}}" IsReadOnly="True" Width="55" MinWidth="45" SortMemberPath="Size"/>
                                <DataGridTextColumn Header="Compressed" Binding="{Binding CompressedSize, Converter={StaticResource SizeConverter}}" IsReadOnly="True" Width="85" MinWidth="45" SortMemberPath="CompressedSize"/>
                                <DataGridTextColumn Header="Resolution" Binding="{Binding Resolution, Converter={StaticResource ResolutionConverter}}" IsReadOnly="True" Width="80" MinWidth="55" SortMemberPath="ResolutionArea"/>
                                <DataGridTextColumn Header="Resize" Binding="{Binding ResizeResolution, Converter={StaticResource ResolutionConverter}}" IsReadOnly="True" Width="70" MinWidth="55" SortMemberPath="ResizeResolutionArea"/>
                                <DataGridTextColumn Header="Format" Binding="{Binding CompressionFormat}" IsReadOnly="True" Width="60" MinWidth="45"/>
                                <DataGridTextColumn Header="Mipmaps" Binding="{Binding MipmapCount}" IsReadOnly="True" Width="65" MinWidth="30"/>
                                <DataGridTextColumn Header="Preset" Binding="{Binding PresetName}" IsReadOnly="True" Width="1*" MinWidth="50">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                            <Setter Property="ToolTip" Value="{Binding PresetName}"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTemplateColumn Header="Status" Width="90" MinWidth="70" SortMemberPath="Status">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Grid>
                                                <ProgressBar MinWidth="60" Width="auto" Minimum="0" Maximum="100" Value="{Binding DownloadProgress}" Visibility="{Binding Status, Converter={StaticResource StatusToVisibilityConverter}}"/>
                                                <TextBlock Text="{Binding StatusOrProgress}"
                                                           Foreground="{Binding EffectiveStatus, Converter={StaticResource StatusToForegroundConverter}}"
                                                           HorizontalAlignment="Center" VerticalAlignment="Center"
                                                           FontWeight="SemiBold"/>
                                            </Grid>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                            <DataGrid.GroupStyle>
                                <!-- Первый уровень: GroupName - простой заголовок без Expander -->
                                <GroupStyle>
                                    <GroupStyle.ContainerStyle>
                                        <Style TargetType="{x:Type GroupItem}">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="{x:Type GroupItem}">
                                                        <StackPanel>
                                                            <Border Background="{DynamicResource ThemeBackgroundAlt}" BorderBrush="{DynamicResource ThemeBorder}" BorderThickness="0,0,0,1" Padding="4,2">
                                                                <StackPanel Orientation="Horizontal">
                                                                    <TextBlock Text="{Binding Name}" FontWeight="Bold" FontSize="11" Foreground="{DynamicResource ThemeForeground}"/>
                                                                    <TextBlock Text=" (" FontSize="10" Foreground="{DynamicResource ThemeForegroundDim}"/>
                                                                    <TextBlock Text="{Binding ItemCount}" FontSize="10" Foreground="{DynamicResource ThemeForegroundDim}"/>
                                                                    <TextBlock Text=")" FontSize="10" Foreground="{DynamicResource ThemeForegroundDim}"/>
                                                                </StackPanel>
                                                            </Border>
                                                            <ItemsPresenter/>
                                                        </StackPanel>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </GroupStyle.ContainerStyle>
                                </GroupStyle>
                                <!-- Второй уровень: SubGroupName (ORM) - простой заголовок -->
                                <GroupStyle>
                                    <GroupStyle.ContainerStyle>
                                        <Style TargetType="{x:Type GroupItem}">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="{x:Type GroupItem}">
                                                        <StackPanel>
                                                            <Border x:Name="SubGroupBorder" Margin="8,1,4,1" BorderBrush="{DynamicResource ThemeMaterialORM}" BorderThickness="1" Background="{DynamicResource ThemeBackgroundAlt}" CornerRadius="2" Padding="4,1"
                                                                    MouseLeftButtonDown="ORMSubGroupHeader_Click" Cursor="Hand">
                                                                <TextBlock Text="{Binding Name}" FontWeight="Bold" FontSize="10" Foreground="{DynamicResource ThemeMaterialORM}"/>
                                                            </Border>
                                                            <ItemsPresenter x:Name="SubGroupItems" Margin="8,0,0,0"/>
                                                            <ItemsPresenter x:Name="DirectItems" Visibility="Collapsed"/>
                                                        </StackPanel>
                                                        <ControlTemplate.Triggers>
                                                            <DataTrigger Binding="{Binding Name}" Value="">
                                                                <Setter TargetName="SubGroupBorder" Property="Visibility" Value="Collapsed"/>
                                                                <Setter TargetName="DirectItems" Property="Visibility" Value="Visible"/>
                                                                <Setter TargetName="SubGroupItems" Property="Visibility" Value="Collapsed"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Name}" Value="{x:Null}">
                                                                <Setter TargetName="SubGroupBorder" Property="Visibility" Value="Collapsed"/>
                                                                <Setter TargetName="DirectItems" Property="Visibility" Value="Visible"/>
                                                                <Setter TargetName="SubGroupItems" Property="Visibility" Value="Collapsed"/>
                                                            </DataTrigger>
                                                        </ControlTemplate.Triggers>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </GroupStyle.ContainerStyle>
                                </GroupStyle>
                            </DataGrid.GroupStyle>
                        </DataGrid>
                    </Grid>
                </TabItem>
                <TabItem x:Name="ModelsTabItem" Header="Models">
                    <Grid Background="{DynamicResource ThemeBackgroundAlt}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="4,2,4,2">
                            <TextBlock Text="Scale:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <Slider Width="120" Minimum="0.5" Maximum="2.0"
                                    Value="{Binding Source={x:Static settings:AppSettings.Default}, Path=ModelsTableScale, Mode=TwoWay}"
                                    TickFrequency="0.1" IsSnapToTickEnabled="True" VerticalAlignment="Center"
                                    ToolTip="Adjust table scale (50% - 200%)"
                                    ValueChanged="TableScaleSlider_ValueChanged"/>
                            <TextBlock Text="{Binding Source={x:Static settings:AppSettings.Default}, Path=ModelsTableScale, StringFormat={}{0:P0}}"
                                       VerticalAlignment="Center" Margin="5,0,0,0" MinWidth="40"/>
                        </StackPanel>
                        <DataGrid x:Name="ModelsDataGrid" Grid.Row="1"
                              AutoGenerateColumns="False"
                              ItemsSource="{Binding Models}"
                              HeadersVisibility="Column"
                              SelectionChanged="ModelsDataGrid_SelectionChanged"
                              Sorting="ModelsDataGrid_Sorting"
                              SizeChanged="ModelsDataGrid_SizeChanged"
                              ColumnDisplayIndexChanged="ModelsDataGrid_ColumnDisplayIndexChanged"
                              IsReadOnly="True"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              CanUserSortColumns="True"
                              CanUserResizeColumns="True"
                              CanUserReorderColumns="True"
                              Background="{DynamicResource ThemeDataGridBackground}"
                              RowHeight="16"
                              VirtualizingPanel.IsVirtualizing="True"
                              VirtualizingPanel.VirtualizationMode="Standard"
                              VirtualizingPanel.ScrollUnit="Item"
                              VirtualizingPanel.CacheLength="100"
                              VirtualizingPanel.CacheLengthUnit="Item"
                              EnableRowVirtualization="True"
                              EnableColumnVirtualization="False"
                              ScrollViewer.CanContentScroll="True"
                              ScrollViewer.IsDeferredScrollingEnabled="False"
                              HorizontalScrollBarVisibility="Disabled">
                            <DataGrid.LayoutTransform>
                                <ScaleTransform ScaleX="{Binding Source={x:Static settings:AppSettings.Default}, Path=ModelsTableScale}"
                                                ScaleY="{Binding Source={x:Static settings:AppSettings.Default}, Path=ModelsTableScale}"/>
                            </DataGrid.LayoutTransform>
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource {x:Type DataGridColumnHeader}}">
                                    <Setter Property="ContextMenu" Value="{StaticResource ModelColumnHeaderContextMenu}"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                            <DataGrid.RowStyle>
                                <Style TargetType="DataGridRow" BasedOn="{StaticResource {x:Type DataGridRow}}">
                                    <Setter Property="ContextMenu" Value="{StaticResource ModelRowContextMenu}"/>
                                </Style>
                            </DataGrid.RowStyle>
                            <DataGrid.CellStyle>
                                <Style TargetType="DataGridCell" BasedOn="{StaticResource {x:Type DataGridCell}}">
                                    <Setter Property="BorderBrush" Value="Transparent"/>
                                </Style>
                            </DataGrid.CellStyle>
                            <DataGrid.Columns>
                                <DataGridCheckBoxColumn Header="Export" Binding="{Binding ExportToServer, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="50" MinWidth="40"
                                                        ElementStyle="{StaticResource DataGridCheckBoxStyle}"
                                                        EditingElementStyle="{StaticResource DataGridCheckBoxStyle}"/>
                                <DataGridTextColumn Header="№" Binding="{Binding Index}" IsReadOnly="True" Width="35" MinWidth="30" />
                                <DataGridTextColumn Header="ID" Binding="{Binding ID}" Width="60" MinWidth="40" />
                                <DataGridTextColumn Header="Model Name" Binding="{Binding Name}" Width="2*" MinWidth="60">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                            <Setter Property="ToolTip" Value="{Binding Name}"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Size" Binding="{Binding Size, Converter={StaticResource SizeConverter}}" Width="55" MinWidth="45" SortMemberPath="Size"/>
                                <DataGridTextColumn Header="UV Channels" Binding="{Binding UVChannels}" Width="80" MinWidth="50"/>
                                <DataGridTextColumn Header="Extension" Binding="{Binding Extension}" Width="65" MinWidth="40"/>
                                <DataGridTemplateColumn Header="Status" Width="90" MinWidth="70" SortMemberPath="Status">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Grid>
                                                <ProgressBar MinWidth="60" Width="auto" Minimum="0" Maximum="100" Value="{Binding DownloadProgress}" Visibility="{Binding Status, Converter={StaticResource StatusToVisibilityConverter}}"/>
                                                <TextBlock Text="{Binding StatusOrProgress}"
                                                           Foreground="{Binding EffectiveStatus, Converter={StaticResource StatusToForegroundConverter}}"
                                                           HorizontalAlignment="Center" VerticalAlignment="Center"
                                                           FontWeight="SemiBold"/>
                                            </Grid>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </TabItem>
                <TabItem x:Name="MaterialsTabItem" Header="Materials">
                    <Grid Background="{DynamicResource ThemeBackgroundAlt}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="38"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <Grid Grid.Row="0" Margin="8,0,8,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="Scale:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <Slider Grid.Column="1" Width="120" Minimum="0.5" Maximum="2.0"
                                    Value="{Binding Source={x:Static settings:AppSettings.Default}, Path=MaterialsTableScale, Mode=TwoWay}"
                                    TickFrequency="0.1" IsSnapToTickEnabled="True" VerticalAlignment="Center"
                                    ToolTip="Adjust table scale (50% - 200%)"
                                    ValueChanged="TableScaleSlider_ValueChanged"/>
                            <TextBlock Grid.Column="2" HorizontalAlignment="Left"
                                       Text="{Binding Source={x:Static settings:AppSettings.Default}, Path=MaterialsTableScale, StringFormat={}{0:P0}}"
                                       VerticalAlignment="Center" Margin="5,0,0,0" MinWidth="40"/>
                            <TextBlock Grid.Column="3" Text="Default Master:" VerticalAlignment="Center" Margin="20,0,8,0" FontWeight="SemiBold"/>
                            <ComboBox Grid.Column="4"
                                      ItemsSource="{Binding MasterMaterialsViewModel.MasterMaterials}"
                                      DisplayMemberPath="Name"
                                      SelectedValuePath="Name"
                                      SelectedValue="{Binding MasterMaterialsViewModel.DefaultMasterMaterial, Mode=TwoWay}"
                                      Width="180" MinHeight="26" Padding="6,4,6,4"
                                      VerticalAlignment="Center" VerticalContentAlignment="Center"
                                      ToolTip="Default master material for materials without explicit assignment"/>
                        </Grid>
                    <DataGrid x:Name="MaterialsDataGrid" Grid.Row="1"
                              AutoGenerateColumns="False"
                              ItemsSource="{Binding Materials}"
                              HeadersVisibility="Column"
                              SelectionChanged="MaterialsDataGrid_SelectionChanged"
                              SelectionMode="Extended"
                              Sorting="MaterialsDataGrid_Sorting"
                              SizeChanged="MaterialsDataGrid_SizeChanged"
                              ColumnDisplayIndexChanged="MaterialsDataGrid_ColumnDisplayIndexChanged"
                              IsReadOnly="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              CanUserSortColumns="True"
                              CanUserResizeColumns="True"
                              CanUserReorderColumns="True"
                              Background="{DynamicResource ThemeDataGridBackground}"
                              RowHeight="16"
                              VirtualizingPanel.IsVirtualizing="True"
                              VirtualizingPanel.VirtualizationMode="Standard"
                              VirtualizingPanel.ScrollUnit="Item"
                              VirtualizingPanel.CacheLength="100"
                              VirtualizingPanel.CacheLengthUnit="Item"
                              EnableRowVirtualization="True"
                              EnableColumnVirtualization="False"
                              ScrollViewer.CanContentScroll="True"
                              ScrollViewer.IsDeferredScrollingEnabled="False"
                              HorizontalScrollBarVisibility="Disabled">
                        <DataGrid.LayoutTransform>
                            <ScaleTransform ScaleX="{Binding Source={x:Static settings:AppSettings.Default}, Path=MaterialsTableScale}"
                                            ScaleY="{Binding Source={x:Static settings:AppSettings.Default}, Path=MaterialsTableScale}"/>
                        </DataGrid.LayoutTransform>
                        <DataGrid.ColumnHeaderStyle>
                            <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource {x:Type DataGridColumnHeader}}">
                                <Setter Property="ContextMenu" Value="{StaticResource MaterialColumnHeaderContextMenu}"/>
                            </Style>
                        </DataGrid.ColumnHeaderStyle>
                        <DataGrid.RowStyle>
                            <Style TargetType="DataGridRow" BasedOn="{StaticResource {x:Type DataGridRow}}">
                                <Setter Property="ContextMenu" Value="{StaticResource MaterialRowContextMenu}"/>
                            </Style>
                        </DataGrid.RowStyle>
                        <DataGrid.CellStyle>
                            <Style TargetType="DataGridCell" BasedOn="{StaticResource {x:Type DataGridCell}}">
                                <Setter Property="BorderBrush" Value="Transparent"/>
                            </Style>
                        </DataGrid.CellStyle>
                        <DataGrid.Columns>
                            <DataGridCheckBoxColumn Header="Export" Binding="{Binding ExportToServer, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="50" MinWidth="40"
                                                    ElementStyle="{StaticResource DataGridCheckBoxStyle}"
                                                    EditingElementStyle="{StaticResource DataGridCheckBoxStyle}"/>
                            <DataGridTextColumn Header="№" Binding="{Binding Index}" IsReadOnly="True" Width="35" MinWidth="30"/>
                            <DataGridTextColumn Header="ID" Binding="{Binding ID}" IsReadOnly="True" Width="60" MinWidth="40" />
                            <DataGridTextColumn Header="Name" Binding="{Binding Name}" IsReadOnly="True" Width="2*" MinWidth="60">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                        <Setter Property="ToolTip" Value="{Binding Name}"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Master" Binding="{Binding MasterMaterialName}" IsReadOnly="True" Width="180" MinWidth="120">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="Padding" Value="4,0"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTemplateColumn Header="Status" Width="90" MinWidth="70" SortMemberPath="Status">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <ProgressBar MinWidth="60" Width="auto" Minimum="0" Maximum="100" Value="{Binding DownloadProgress}" Visibility="{Binding Status, Converter={StaticResource StatusToVisibilityConverter}}"/>
                                            <TextBlock Text="{Binding StatusOrProgress}"
                                                       Foreground="{Binding EffectiveStatus, Converter={StaticResource StatusToForegroundConverter}}"
                                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                                                       FontWeight="SemiBold"/>
                                        </Grid>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                    </Grid>
                </TabItem>
                <TabItem Header="Master Materials">
                    <controls:MasterMaterialsEditorPanel x:Name="masterMaterialsEditorPanel"/>
                </TabItem>
                <TabItem Header="Server" Height="22" Margin="-2,-2,-2,0" VerticalAlignment="Top"
                         Background="#FF9C27B0">
                    <controls:ServerAssetsPanel x:Name="ServerAssetsPanel"/>
                </TabItem>
                <TabItem Header="Logs" Height="22" Margin="-2,-2,-2,0" VerticalAlignment="Top">
                    <controls:LogViewerControl/>
                </TabItem>
            </TabControl>

            <GridSplitter x:Name="RightPanelSplitter" Grid.Column="1" Width="7" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" ResizeBehavior="PreviousAndNext" Background="{DynamicResource ThemeBorder}" FontSize="6"
                          DragCompleted="RightPanelSplitter_DragCompleted"/>

            <Button Grid.Column="1" Content="{Binding ToggleViewButtonContent}"
                Click="ToggleViewerButton_Click" Background="{DynamicResource ThemeBackgroundAlt}" Padding="0,0,0,0" Grid.RowSpan="1" VerticalContentAlignment="Center" HorizontalContentAlignment="Center" Height="32" Width="7" BorderThickness="0,0,0,0" VerticalAlignment="Center" MinWidth="0" MinHeight="0" FontSize="6" FontFamily="Arial" Foreground="{DynamicResource ThemeAccent}"/>

            <ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Visibility="{Binding ActiveViewerType, Converter={StaticResource EnumToVisibilityConverter}, ConverterParameter=Texture}" SizeChanged="TextureViewerScroll_SizeChanged" PreviewMouseWheel="TextureViewerScroll_PreviewMouseWheel">
                <Border x:Name="TextureViewer" Background="{DynamicResource ThemeBackground}" BorderThickness="2,2,2,2" BorderBrush="{DynamicResource ThemeBorder}" Padding="0,0,0,0" MinWidth="128" MinHeight="128">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <!-- Preview Section -->
                        <Expander Grid.Row="0" Header="Preview" IsExpanded="True" Style="{StaticResource RightPanelExpanderStyle}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition x:Name="PreviewContentRow" Height="300" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <!-- Texture Info Panel (ABOVE viewport to avoid HwndHost airspace issue) -->
                                <Border Grid.Row="0" Background="#DD000000" BorderThickness="0,0,0,1" BorderBrush="#FF555555" Padding="6,4">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0" Orientation="Vertical" Margin="0,0,12,0">
                                            <TextBlock Text="{Binding TextureInfoName}"
                                                      Foreground="White"
                                                      FontSize="10"
                                                      FontWeight="SemiBold"
                                                      Margin="0,0,0,2" />
                                            <TextBlock Text="{Binding TextureInfoResolution}"
                                                      Foreground="#FFCCCCCC"
                                                      FontSize="9"
                                                      Margin="0,0,0,1" />
                                        </StackPanel>

                                        <StackPanel Grid.Column="1" Orientation="Vertical">
                                            <TextBlock Text="{Binding TextureInfoSize}"
                                                      Foreground="#FFCCCCCC"
                                                      FontSize="9"
                                                      Margin="0,0,0,1" />
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding TextureInfoColorSpace}"
                                                          Foreground="#FFAAAAAA"
                                                          FontSize="9"
                                                          Margin="0,0,8,0" />
                                                <TextBlock Text="{Binding TextureInfoFormat}"
                                                          Foreground="#FFAAAAAA"
                                                          FontSize="9" />
                                            </StackPanel>
                                        </StackPanel>
                                    </Grid>
                                </Border>

                                <!-- Texture Viewport -->
                                <Border Grid.Row="1" BorderBrush="{DynamicResource ThemeBorder}" BorderThickness="1" Margin="0" MinWidth="128" MinHeight="128" VerticalAlignment="Stretch">
                                    <Grid x:Name="TexturePreviewViewport"
                                          Background="#FF333333"
                                          ClipToBounds="True"
                                          SizeChanged="TexturePreviewViewport_SizeChanged"
                                          PreviewMouseWheel="D3D11TextureViewer_PreviewMouseWheel"
                                          MouseEnter="TexturePreviewViewport_MouseEnter"
                                          MouseLeave="TexturePreviewViewport_MouseLeave"
                                          Focusable="True">
                                        <!-- D3D11 Texture Viewer (GPU-accelerated, default) -->
                                        <!-- HwndHost does NOT receive WPF MouseWheel events - handle on parent Grid -->
                                        <!-- Bounds check happens directly in PreviewMouseWheel - no need for MouseMove/MouseLeave -->
                                        <viewer:D3D11TextureViewerControl x:Name="D3D11TextureViewer"
                                                                           Visibility="Visible" />

                                        <!-- WPF Image Viewer (software fallback, legacy mode) -->
                                        <Image x:Name="WpfTexturePreviewImage"
                                               Stretch="Uniform"
                                               RenderOptions.BitmapScalingMode="HighQuality"
                                               Visibility="Collapsed" />
                                    </Grid>
                                </Border>

                                <GridSplitter Grid.Row="2"
                                              Height="6"
                                              Margin="0,4,0,4"
                                              Background="{DynamicResource ThemeBackgroundAlt}"
                                              HorizontalAlignment="Stretch"
                                              ResizeDirection="Rows"
                                              ResizeBehavior="PreviousAndNext"
                                              ShowsPreview="False"
                                              Cursor="SizeNS"
                                              DragDelta="PreviewHeightGridSplitter_DragDelta" />

                                <StackPanel Grid.Row="3" Orientation="Vertical" HorizontalAlignment="Left" Margin="6,4,6,6">
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,6" VerticalAlignment="Center">
                                        <TextBlock Text="Источник превью:" FontSize="10" VerticalAlignment="Center" />
                                        <RadioButton Content="Source"
                                                     GroupName="TexturePreviewSource"
                                                     Margin="8,0,0,0"
                                                     IsEnabled="{Binding IsPreviewSourceOriginalEnabled}"
                                                     IsChecked="{Binding IsPreviewSourceOriginalChecked}"
                                                     Checked="PreviewSourceRadioButton_Checked" />
                                        <RadioButton Content="KTX2"
                                                     GroupName="TexturePreviewSource"
                                                     Margin="8,0,0,0"
                                                     IsEnabled="{Binding IsPreviewSourceKtxEnabled}"
                                                     IsChecked="{Binding IsPreviewSourceKtxChecked}"
                                                     Checked="PreviewSourceRadioButton_Checked" />
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" Height="20" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="0,0,0,6" RenderTransformOrigin="0.5,0.5">
                                        <StackPanel.RenderTransform>
                                            <TransformGroup>
                                                <ScaleTransform ScaleX="1"/>
                                                <SkewTransform/>
                                                <RotateTransform/>
                                                <TranslateTransform/>
                                            </TransformGroup>
                                        </StackPanel.RenderTransform>
                                        <ToggleButton Content="R" Tag="R" Width="30" Height="20" Background="#FFCE3737" IsChecked="{Binding IsRChannelChecked}" Click="FilterButton_Click" BorderBrush="{DynamicResource ThemeBorder}"/>
                                        <ToggleButton Content="G" Tag="G" Width="30" Height="20" Background="#FF73CE37" IsChecked="{Binding IsGChannelChecked}" Click="FilterButton_Click" BorderBrush="{DynamicResource ThemeBorder}"/>
                                        <ToggleButton Content="B" Tag="B" Width="30" Height="20" Background="#FF3785CE" IsChecked="{Binding IsBChannelChecked}" Click="FilterButton_Click" BorderBrush="{DynamicResource ThemeBorder}"/>
                                        <ToggleButton Content="A" Tag="A" Width="30" Height="20" Background="Gray" Foreground="White" IsChecked="{Binding IsAChannelChecked}" Click="FilterButton_Click" HorizontalContentAlignment="Center" BorderThickness="1,1,1,1" BorderBrush="{DynamicResource ThemeBorder}"/>
                                        <ToggleButton Content="Nrm" Tag="Normal" Width="35" Height="20" Background="#FF4488FF" Foreground="White" IsChecked="{Binding IsNormalChannelChecked}" Click="FilterButton_Click" HorizontalContentAlignment="Center" BorderThickness="1,1,1,1" BorderBrush="{DynamicResource ThemeBorder}" Margin="2,0,0,0"/>

                                        <!-- Fit/Reset button -->
                                        <Button Content="Fit" Width="35" Height="20" Margin="4,0,0,0" Background="{DynamicResource ThemeBackgroundAlt}" Click="FitResetButton_Click" BorderBrush="{DynamicResource ThemeBorder}" FontSize="10" Padding="2"/>

                                        <!-- Filter toggle button (Point/Trilinear) -->
                                        <ToggleButton Content="Filter" Width="45" Height="20" Margin="4,0,0,0" Background="{DynamicResource ThemeBackgroundAlt}" IsChecked="{Binding IsFilterEnabled}" Click="FilterToggleButton_Click" BorderBrush="{DynamicResource ThemeBorder}" FontSize="9" Padding="2"/>

                                        <!-- Tile toggle button -->
                                        <ToggleButton Content="Tiles" Width="45" Height="20" Margin="4,0,0,0" Background="{DynamicResource ThemeBackgroundAlt}" IsChecked="{Binding IsTilingEnabled}" Click="TileToggleButton_Click" BorderBrush="{DynamicResource ThemeBorder}" FontSize="9" Padding="2"/>

                                        <!-- Histogram correction toggle button -->
                                        <ToggleButton Content="Hist" Width="35" Height="20" Margin="4,0,0,0" Background="#FFFFD700" IsEnabled="{Binding IsHistogramCorrectionEnabled}" IsChecked="{Binding IsHistogramCorrectionChecked}" Click="HistogramCorrectionButton_Click" BorderBrush="{DynamicResource ThemeBorder}" FontSize="9" Padding="2" ToolTip="{Binding HistogramCorrectionToolTip}"/>
                                    </StackPanel>
                                    <Border Margin="0,6,0,0" Background="{DynamicResource ThemeBackgroundAlt}" Padding="4" Visibility="{Binding IsMipmapSliderVisible, Converter={StaticResource BooleanToVisibilityConverter}}" HorizontalAlignment="Left">
                                        <StackPanel Orientation="Vertical">
                                            <TextBlock Text="{Binding MipmapInfoText}" FontSize="10" Margin="0,0,0,4" />
                                            <Slider x:Name="MipmapLevelSlider"
                                                    Minimum="0"
                                                    Maximum="0"
                                                    TickFrequency="1"
                                                    IsSnapToTickEnabled="True"
                                                    AutoToolTipPlacement="TopLeft"
                                                    AutoToolTipPrecision="0"
                                                    ValueChanged="MipmapLevelSlider_ValueChanged"
                                                    Width="220" />
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </Grid>
                        </Expander>

                        <!-- Histogram Section -->
                        <controls:HistogramPanel Grid.Row="1"/>

                        <!-- Conversion Settings Panel -->
                        <Expander Grid.Row="2" Header="Conversion Settings"
                                  Style="{StaticResource RightPanelExpanderStyle}" IsExpanded="True"
                                  Visibility="{Binding IsConversionSettingsVisible, Converter={StaticResource BooleanToVisibilityConverter}}"
                                  Expanded="ConversionSettingsExpander_Expanded"
                                  Collapsed="ConversionSettingsExpander_Collapsed">
                            <controls:TextureConversionSettingsPanel x:Name="ConversionSettingsPanel"
                                                                     SettingsChanged="ConversionSettingsPanel_SettingsChanged"/>
                        </Expander>

                        <!-- ORM Packing Panel (only visible when ORM texture is selected) -->
                        <controls:ORMPackingPanel Grid.Row="3"
                                                  x:Name="ORMPanel"
                                                  Visibility="{Binding IsORMPanelVisible, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                  Margin="0,2,0,0"/>
                    </Grid>
                </Border>
            </ScrollViewer>

            <ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Visibility="{Binding ActiveViewerType, Converter={StaticResource EnumToVisibilityConverter}, ConverterParameter=Model}"
                          PreviewMouseWheel="ModelViewerScroll_PreviewMouseWheel">
                <Border x:Name="ModelViewer" Background="{DynamicResource ThemeBackground}" BorderThickness="2,2,2,2" BorderBrush="{DynamicResource ThemeBorder}" Padding="0,0,0,0" MinWidth="128" MinHeight="128">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition x:Name="ModelPreviewRow" Height="400" MinHeight="200" MaxHeight="1200" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" MinHeight="150" />
                        </Grid.RowDefinitions>

                        <!-- Model Preview Section -->
                        <Expander Grid.Row="0" Header="Model Preview" IsExpanded="True" Style="{StaticResource RightPanelExpanderStyle}">
                            <Grid MinHeight="200">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition x:Name="ModelViewportRow" Height="300" MinHeight="100" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <!-- Model Info Panel (ABOVE viewport) -->
                                <Border Grid.Row="0" Background="#DD000000" BorderThickness="0,0,0,1" BorderBrush="#FF555555" Padding="6,4">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0" Orientation="Vertical" Margin="0,0,12,0">
                                            <TextBlock Text="{Binding ModelInfoName}"
                                                      Foreground="White"
                                                      FontSize="10"
                                                      FontWeight="SemiBold"
                                                      Margin="0,0,0,2" />
                                            <TextBlock Text="{Binding ModelInfoTriangles}"
                                                      Foreground="#FFCCCCCC"
                                                      FontSize="9"
                                                      Margin="0,0,0,1" />
                                        </StackPanel>

                                        <!-- Viewer Controls (Right Column) -->
                                        <StackPanel Grid.Column="1" Orientation="Vertical">
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                                <CheckBox Content="Pivot"
                                                         Style="{StaticResource DarkBackgroundCheckBoxStyle}"
                                                         IsChecked="{Binding IsShowPivotChecked}"
                                                         Checked="ShowPivotCheckBox_Changed"
                                                         Unchecked="ShowPivotCheckBox_Changed" />
                                                <CheckBox Content="Wireframe"
                                                         Style="{StaticResource DarkBackgroundCheckBoxStyle}"
                                                         IsChecked="{Binding IsShowWireframeChecked}"
                                                         Checked="ShowWireframeCheckBox_Changed"
                                                         Unchecked="ShowWireframeCheckBox_Changed" />
                                                <CheckBox Content="1.8m"
                                                         Style="{StaticResource DarkBackgroundCheckBoxStyle}"
                                                         IsChecked="{Binding IsShowHumanChecked}"
                                                         Checked="ShowHumanCheckBox_Changed"
                                                         Unchecked="ShowHumanCheckBox_Changed" />
                                                <TextBlock Text="Up:"
                                                          Foreground="White"
                                                          FontSize="9"
                                                          VerticalAlignment="Center"
                                                          Margin="0,0,4,0" />
                                                <ComboBox x:Name="UpVectorComboBox"
                                                         FontSize="9"
                                                         Width="40"
                                                         Height="18"
                                                         Padding="4,0"
                                                         SelectionChanged="UpVectorComboBox_SelectionChanged">
                                                    <ComboBoxItem Content="Y" IsSelected="True" />
                                                    <ComboBoxItem Content="Z" />
                                                </ComboBox>
                                            </StackPanel>
                                            <TextBlock Text="{Binding ModelCurrentLodText}"
                                                      Foreground="#FFCCCCCC"
                                                      FontSize="9"
                                                      Margin="0,0,0,1"
                                                      Visibility="{Binding IsModelCurrentLodVisible, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                            <TextBlock Text="{Binding ModelInfoVertices}"
                                                      Foreground="#FFCCCCCC"
                                                      FontSize="9"
                                                      Margin="0,0,0,1" />
                                            <TextBlock Text="{Binding ModelInfoUVChannels}"
                                                      Foreground="#FFAAAAAA"
                                                      FontSize="9" />
                                        </StackPanel>
                                    </Grid>
                                </Border>

                                <!-- 3D Viewport -->
                                <Border Grid.Row="1" Background="#FF414D58" BorderBrush="{DynamicResource ThemeBorder}" BorderThickness="1" Margin="0" MinWidth="128" MinHeight="128" VerticalAlignment="Stretch"
                                        PreviewMouseWheel="HelixViewportBorder_PreviewMouseWheel"
                                        MouseWheel="HelixViewportBorder_MouseWheel">
                                    <helix:HelixViewport3D x:Name="viewPort3d"
                                                          Focusable="True"
                                                          FocusVisualStyle="{x:Null}"
                                                          ZoomExtentsWhenLoaded="true"
                                                          ShowCoordinateSystem="false"
                                                          ShowViewCube="true"
                                                          IsInertiaEnabled="False"
                                                          IsRotationEnabled="True"
                                                          IsPanEnabled="True"
                                                          IsZoomEnabled="True"
                                                          CameraRotationMode="Turntable"
                                                          RotateAroundMouseDownPoint="True"
                                                          ZoomAroundMouseDownPoint="True"
                                                          ZoomSensitivity="1"
                                                          RotateGesture="LeftClick"
                                                          PanGesture="MiddleClick">
                                        <helix:HelixViewport3D.CacheMode>
                                            <BitmapCache RenderAtScale="2" />
                                        </helix:HelixViewport3D.CacheMode>
                                        <helix:DefaultLights/>
                                    </helix:HelixViewport3D>
                                </Border>

                                <!-- Drag handle for resizing viewport (Thumb instead of GridSplitter to avoid auto-resize of LOD panel) -->
                                <Thumb Grid.Row="2"
                                       Height="6"
                                       Margin="0,4,0,4"
                                       HorizontalAlignment="Stretch"
                                       Cursor="SizeNS"
                                       DragDelta="ModelViewportGridSplitter_DragDelta">
                                    <Thumb.Template>
                                        <ControlTemplate TargetType="Thumb">
                                            <Border Background="{DynamicResource ThemeBackgroundAlt}"
                                                    CornerRadius="2" />
                                        </ControlTemplate>
                                    </Thumb.Template>
                                </Thumb>
                            </Grid>
                        </Expander>

                        <!-- LOD Controls Panel (outside Expander so it can't be clipped by resize) -->
                        <StackPanel Grid.Row="1" Orientation="Vertical" Margin="6,4,6,2" Visibility="{Binding IsLodControlsVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Source:"
                                          Foreground="{DynamicResource ThemeForeground}"
                                          FontSize="10"
                                          VerticalAlignment="Center"
                                          Margin="0,0,6,0" />
                                <Button Content="FBX"
                                       Click="SourceTypeButton_Click"
                                       Tag="FBX"
                                       Width="45"
                                       Height="20"
                                       Margin="2,0"
                                       FontSize="9"
                                       Padding="2"
                                       BorderBrush="{DynamicResource ThemeBorder}"
                                       ToolTip="Show original FBX model">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="FontWeight" Value="Normal"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsShowingFbxSource}" Value="True">
                                                    <Setter Property="FontWeight" Value="Bold"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                                <Button Content="GLB"
                                       Click="SourceTypeButton_Click"
                                       Tag="GLB"
                                       Width="45"
                                       Height="20"
                                       Margin="2,0"
                                       FontSize="9"
                                       Padding="2"
                                       BorderBrush="{DynamicResource ThemeBorder}"
                                       ToolTip="Show converted GLB model">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="FontWeight" Value="Bold"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsShowingFbxSource}" Value="True">
                                                    <Setter Property="FontWeight" Value="Normal"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>

                                <Separator Width="10" Background="Transparent" />

                                <!-- LOD Slider -->
                                <TextBlock Text="LOD:"
                                          Foreground="{DynamicResource ThemeForeground}"
                                          FontSize="10"
                                          VerticalAlignment="Center"
                                          Margin="0,0,6,0" />
                                <Slider Minimum="0"
                                       Maximum="{Binding LodSliderMaximum}"
                                       Value="{Binding LodSliderValue, Mode=OneWay}"
                                       IsEnabled="{Binding IsLodSliderEnabled}"
                                       TickFrequency="1"
                                       IsSnapToTickEnabled="True"
                                       Width="100"
                                       VerticalAlignment="Center"
                                       ValueChanged="LodSlider_ValueChanged"
                                       ToolTip="Select LOD level" />
                                <TextBlock Text="{Binding LodValueText}"
                                          Foreground="{DynamicResource ThemeForeground}"
                                          FontSize="10"
                                          FontWeight="SemiBold"
                                          VerticalAlignment="Center"
                                          Margin="6,0,0,0"
                                          MinWidth="35" />
                                <TextBlock Text="{Binding LodInfoText}"
                                          Foreground="{DynamicResource ThemeForegroundDim}"
                                          FontSize="9"
                                          VerticalAlignment="Center"
                                          Margin="8,0,0,0" />
                            </StackPanel>
                        </StackPanel>

                        <!-- Drag handle between Model Preview and bottom section -->
                        <Thumb Grid.Row="2"
                               Height="6"
                               Margin="0,4,0,4"
                               HorizontalAlignment="Stretch"
                               Cursor="SizeNS"
                               DragDelta="ModelPreviewGridSplitter_DragDelta"
                               DragCompleted="ModelPreviewGridSplitter_DragCompleted">
                            <Thumb.Template>
                                <ControlTemplate TargetType="Thumb">
                                    <Border Background="{DynamicResource ThemeBackgroundAlt}"
                                            CornerRadius="2" />
                                </ControlTemplate>
                            </Thumb.Template>
                        </Thumb>

                        <!-- Bottom section: UV Maps + Settings -->
                        <Grid Grid.Row="3">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                        <!-- UV Maps Section -->
                        <Expander Grid.Row="0" Header="UV Maps" IsExpanded="False" Style="{StaticResource RightPanelExpanderStyle}">
                            <Border BorderBrush="{DynamicResource ThemeBorder}" BorderThickness="1" Margin="0" MinWidth="128" MinHeight="137" MaxHeight="300">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Text="UV Map 1" HorizontalAlignment="Center" Margin="0,5,0,5" FontWeight="Bold" Foreground="{DynamicResource ThemeForeground}"/>
                                        <Viewbox Stretch="Uniform" MinWidth="128" MinHeight="128" Grid.Row="1">
                                            <Image x:Name="UVImage" Stretch="Uniform" MinWidth="128" MinHeight="128" />
                                        </Viewbox>
                                    </Grid>
                                    <Grid Grid.Column="1">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Text="UV Map 2" HorizontalAlignment="Center" Margin="0,5,0,5" FontWeight="Bold" Foreground="{DynamicResource ThemeForeground}"/>
                                        <Viewbox Stretch="Uniform" MinWidth="128" MinHeight="128" Grid.Row="1">
                                            <Image x:Name="UVImage2" Stretch="Uniform" MinWidth="128" MinHeight="128" />
                                        </Viewbox>
                                    </Grid>
                                </Grid>
                            </Border>
                        </Expander>

                        <!-- Model Conversion Settings Panel -->
                        <Expander Grid.Row="1" Header="Model Conversion Settings"
                                  Style="{StaticResource RightPanelExpanderStyle}" IsExpanded="True">
                            <controls:ModelConversionSettingsPanel x:Name="ModelConversionSettingsPanel"
                                                                   ProcessRequested="ModelConversionSettingsPanel_ProcessRequested"/>
                        </Expander>
                        </Grid>
                    </Grid>
                </Border>
            </ScrollViewer>

            <!-- Просмотр параметров материала -->
            <ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Visibility="{Binding ActiveViewerType, Converter={StaticResource EnumToVisibilityConverter}, ConverterParameter=Material}">
                <controls:MaterialInfoPanel x:Name="materialInfoPanel"/>
            </ScrollViewer>

            <!-- Server File Info Panel -->
            <ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Visibility="{Binding ActiveViewerType, Converter={StaticResource EnumToVisibilityConverter}, ConverterParameter=ServerFile}">
                <controls:ServerFileInfoPanel x:Name="serverFileInfoPanel"/>
            </ScrollViewer>

            <!-- Chunk Slots Panel (for Master Materials tab) -->
            <ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Visibility="{Binding ActiveViewerType, Converter={StaticResource EnumToVisibilityConverter}, ConverterParameter=ChunkSlots}">
                <controls:ChunkSlotsPanel x:Name="chunkSlotsPanel"/>
            </ScrollViewer>

        </Grid>
    </DockPanel>
</Window>
