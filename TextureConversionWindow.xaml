<Window x:Class="AssetProcessor.TextureConversionWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:AssetProcessor"
        xmlns:core="clr-namespace:AssetProcessor.TextureConversion.Core"
        mc:Ignorable="d"
        Title="Texture Conversion Pipeline"
        Height="700" Width="1200"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <!-- Converters -->
        <local:NullToBoolConverter x:Key="NullToBoolConverter"/>
        <local:InverseBoolConverter x:Key="InverseBoolConverter"/>

        <!-- Enum to ComboBox converter -->
        <ObjectDataProvider x:Key="TextureTypeValues" MethodName="GetValues" ObjectType="{x:Type core:TextureType}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="core:TextureType"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>

        <ObjectDataProvider x:Key="FilterTypeValues" MethodName="GetValues" ObjectType="{x:Type core:FilterType}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="core:FilterType"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>

        <ObjectDataProvider x:Key="CompressionFormatValues" MethodName="GetValues" ObjectType="{x:Type core:CompressionFormat}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="core:CompressionFormat"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>

        <ObjectDataProvider x:Key="OutputFormatValues" MethodName="GetValues" ObjectType="{x:Type core:OutputFormat}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="core:OutputFormat"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>

        <ObjectDataProvider x:Key="KTX2SupercompressionValues" MethodName="GetValues" ObjectType="{x:Type core:KTX2SupercompressionType}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="core:KTX2SupercompressionType"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Top toolbar -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
            <Button Content="Add Textures" Command="{Binding AddTexturesCommand}" Width="120" Height="30" Margin="0,0,5,0"/>
            <Button Content="Remove Selected" Command="{Binding RemoveTextureCommand}" Width="120" Height="30" Margin="0,0,20,0"/>

            <TextBlock Text="Output Directory:" VerticalAlignment="Center" Margin="0,0,5,0"/>
            <TextBox Text="{Binding OutputDirectory, UpdateSourceTrigger=PropertyChanged}" Width="300" VerticalAlignment="Center" Margin="0,0,5,0"/>
            <Button Content="Browse..." Command="{Binding SelectOutputDirectoryCommand}" Width="80" Height="30"/>
        </StackPanel>

        <!-- Main content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="350"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Texture list -->
            <GroupBox Grid.Column="0" Header="Textures" Margin="0,0,5,0">
                <DataGrid ItemsSource="{Binding Textures}"
                          SelectedItem="{Binding SelectedTexture}"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          SelectionMode="Single">
                    <DataGrid.Columns>
                        <DataGridCheckBoxColumn Header="âœ“" Binding="{Binding IsEnabled}" Width="30"/>
                        <DataGridTextColumn Header="Name" Binding="{Binding TextureName}" Width="200" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Type" Binding="{Binding TextureType}" Width="80" IsReadOnly="True"/>
                    </DataGrid.Columns>
                </DataGrid>
            </GroupBox>

            <!-- Settings panel -->
            <ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="5,0,0,0">
                    <GroupBox Header="Quick Presets" Margin="0,0,0,10">
                        <StackPanel>
                            <TextBlock Text="Apply preset to:" Margin="0,0,0,5"/>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                <Button Content="Selected - High Quality" Command="{Binding ApplyPresetToSelectedCommand}" CommandParameter="HighQuality" Width="150" Margin="0,0,5,0"/>
                                <Button Content="Selected - Balanced" Command="{Binding ApplyPresetToSelectedCommand}" CommandParameter="Balanced" Width="150" Margin="0,0,5,0"/>
                                <Button Content="Selected - Small Size" Command="{Binding ApplyPresetToSelectedCommand}" CommandParameter="SmallSize" Width="150"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <Button Content="All - High Quality" Command="{Binding ApplyPresetToAllCommand}" CommandParameter="HighQuality" Width="150" Margin="0,0,5,0"/>
                                <Button Content="All - Balanced" Command="{Binding ApplyPresetToAllCommand}" CommandParameter="Balanced" Width="150" Margin="0,0,5,0"/>
                                <Button Content="All - Small Size" Command="{Binding ApplyPresetToAllCommand}" CommandParameter="SmallSize" Width="150"/>
                            </StackPanel>
                        </StackPanel>
                    </GroupBox>

                    <!-- Texture settings (only shown when texture is selected) -->
                    <GroupBox Header="Texture Settings" IsEnabled="{Binding SelectedTexture, Converter={StaticResource NullToBoolConverter}}">
                        <StackPanel DataContext="{Binding SelectedTexture}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Texture Type:" VerticalAlignment="Center" Margin="0,5"/>
                                <ComboBox Grid.Row="0" Grid.Column="1" ItemsSource="{Binding Source={StaticResource TextureTypeValues}}"
                                          SelectedItem="{Binding TextureType}" Margin="0,5"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Save Separate Mipmaps:" VerticalAlignment="Center" Margin="0,5"/>
                                <CheckBox Grid.Row="1" Grid.Column="1" IsChecked="{Binding SaveSeparateMipmaps}" VerticalAlignment="Center" Margin="0,5"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Enabled:" VerticalAlignment="Center" Margin="0,5"/>
                                <CheckBox Grid.Row="2" Grid.Column="1" IsChecked="{Binding IsEnabled}" VerticalAlignment="Center" Margin="0,5"/>
                            </Grid>
                        </StackPanel>
                    </GroupBox>

                    <!-- Mipmap settings -->
                    <GroupBox Header="Mipmap Generation" Margin="0,10,0,0" IsEnabled="{Binding SelectedTexture, Converter={StaticResource NullToBoolConverter}}">
                        <Grid DataContext="{Binding SelectedTexture.MipProfile}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Filter:" VerticalAlignment="Center" Margin="0,5"/>
                            <ComboBox Grid.Row="0" Grid.Column="1" ItemsSource="{Binding Source={StaticResource FilterTypeValues}}"
                                      SelectedItem="{Binding Filter}" Margin="0,5"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Apply Gamma Correction:" VerticalAlignment="Center" Margin="0,5"/>
                            <CheckBox Grid.Row="1" Grid.Column="1" IsChecked="{Binding ApplyGammaCorrection}" VerticalAlignment="Center" Margin="0,5"/>

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Gamma:" VerticalAlignment="Center" Margin="0,5"/>
                            <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding Gamma}" Margin="0,5"/>

                            <TextBlock Grid.Row="3" Grid.Column="0" Text="Blur Radius:" VerticalAlignment="Center" Margin="0,5"/>
                            <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding BlurRadius}" Margin="0,5"/>

                            <TextBlock Grid.Row="4" Grid.Column="0" Text="Min Mip Size:" VerticalAlignment="Center" Margin="0,5"/>
                            <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding MinMipSize}" Margin="0,5"/>

                            <TextBlock Grid.Row="5" Grid.Column="0" Text="Include Last Level:" VerticalAlignment="Center" Margin="0,5"/>
                            <CheckBox Grid.Row="5" Grid.Column="1" IsChecked="{Binding IncludeLastLevel}" VerticalAlignment="Center" Margin="0,5"/>

                            <TextBlock Grid.Row="6" Grid.Column="0" Text="Normalize Normals:" VerticalAlignment="Center" Margin="0,5"/>
                            <CheckBox Grid.Row="6" Grid.Column="1" IsChecked="{Binding NormalizeNormals}" VerticalAlignment="Center" Margin="0,5"/>
                        </Grid>
                    </GroupBox>

                    <!-- Compression settings -->
                    <GroupBox Header="Compression Settings" Margin="0,10,0,0" IsEnabled="{Binding SelectedTexture, Converter={StaticResource NullToBoolConverter}}">
                        <Grid DataContext="{Binding SelectedTexture.Compression}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Compression Format:" VerticalAlignment="Center" Margin="0,5"/>
                            <ComboBox Grid.Row="0" Grid.Column="1" ItemsSource="{Binding Source={StaticResource CompressionFormatValues}}"
                                      SelectedItem="{Binding CompressionFormat}" Margin="0,5"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Output Format:" VerticalAlignment="Center" Margin="0,5"/>
                            <ComboBox Grid.Row="1" Grid.Column="1" ItemsSource="{Binding Source={StaticResource OutputFormatValues}}"
                                      SelectedItem="{Binding OutputFormat}" Margin="0,5"/>

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="ETC1S Quality:" VerticalAlignment="Center" Margin="0,5"/>
                            <StackPanel Grid.Row="2" Grid.Column="1" Orientation="Horizontal" Margin="0,5">
                                <Slider Value="{Binding QualityLevel}" Minimum="0" Maximum="255" Width="200" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding QualityLevel}" Margin="10,0,0,0" VerticalAlignment="Center"/>
                            </StackPanel>

                            <TextBlock Grid.Row="3" Grid.Column="0" Text="UASTC Quality:" VerticalAlignment="Center" Margin="0,5"/>
                            <StackPanel Grid.Row="3" Grid.Column="1" Orientation="Horizontal" Margin="0,5">
                                <Slider Value="{Binding UASTCQuality}" Minimum="0" Maximum="4" Width="200" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding UASTCQuality}" Margin="10,0,0,0" VerticalAlignment="Center"/>
                            </StackPanel>

                            <TextBlock Grid.Row="4" Grid.Column="0" Text="Use UASTC RDO:" VerticalAlignment="Center" Margin="0,5"/>
                            <CheckBox Grid.Row="4" Grid.Column="1" IsChecked="{Binding UseUASTCRDO}" VerticalAlignment="Center" Margin="0,5"/>

                            <TextBlock Grid.Row="5" Grid.Column="0" Text="Perceptual Mode:" VerticalAlignment="Center" Margin="0,5"/>
                            <CheckBox Grid.Row="5" Grid.Column="1" IsChecked="{Binding PerceptualMode}" VerticalAlignment="Center" Margin="0,5"/>

                            <TextBlock Grid.Row="6" Grid.Column="0" Text="KTX2 Supercompression:" VerticalAlignment="Center" Margin="0,5"/>
                            <ComboBox Grid.Row="6" Grid.Column="1" ItemsSource="{Binding Source={StaticResource KTX2SupercompressionValues}}"
                                      SelectedItem="{Binding KTX2Supercompression}" Margin="0,5"
                                      ToolTip="Supercompression for KTX2 files (only affects KTX2 output)"/>
                        </Grid>
                    </GroupBox>
                </StackPanel>
            </ScrollViewer>
        </Grid>

        <!-- Progress -->
        <GroupBox Grid.Row="2" Header="Processing" Margin="0,10,0,0">
            <StackPanel>
                <TextBlock Text="{Binding ProcessingStatus}" Margin="0,0,0,5"/>
                <ProgressBar Height="20" Value="{Binding ProcessingProgress}" Maximum="100"/>
            </StackPanel>
        </GroupBox>

        <!-- Bottom buttons -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
            <Button Content="Process Selected" Command="{Binding ProcessSelectedTextureCommand}"
                    Width="150" Height="35" Margin="0,0,10,0"
                    IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolConverter}}"/>
            <Button Content="Process All Enabled" Command="{Binding ProcessAllTexturesCommand}"
                    Width="150" Height="35" Margin="0,0,10,0"
                    IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolConverter}}"/>
            <Button Content="Save Settings" Command="{Binding SaveSettingsCommand}" Width="120" Height="35"/>
        </StackPanel>
    </Grid>
</Window>
